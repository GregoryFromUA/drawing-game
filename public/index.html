<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doodle Prophet Unicorn Canvas Cobra</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
        }
        
        /* –ú–µ–Ω—é —Ç–∞ –ª–æ–±—ñ —Å—Ç–∏–ª—ñ */
        .lobby-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }
        
        .lobby {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 900px;
            width: 100%;
        }
        
        .lobby h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 25px;
            font-size: 2em;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .lobby-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }
        
        .lobby-left, .lobby-right {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .room-code {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        
        .room-code h2 {
            color: #667eea;
            margin-bottom: 8px;
            font-size: 1.1em;
        }
        
        .room-code .code {
            font-size: 1.8em;
            font-weight: bold;
            letter-spacing: 5px;
            color: #333;
        }
        
        .clickable-code {
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
            user-select: all;
            padding: 8px;
            border-radius: 10px;
        }
        
        .clickable-code:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .clickable-code:active {
            transform: scale(0.98);
        }
        
        .copy-success {
            position: absolute;
            right: -120px;
            top: 50%;
            transform: translateY(-50%);
            background: #4caf50;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8em;
            animation: fadeInOut 2s ease;
            pointer-events: none;
            white-space: nowrap;
        }
        
        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateY(-50%) translateX(-10px); }
            20% { opacity: 1; transform: translateY(-50%) translateX(0); }
            80% { opacity: 1; transform: translateY(-50%) translateX(0); }
            100% { opacity: 0; transform: translateY(-50%) translateX(10px); }
        }
        
        .code-hint {
            font-size: 0.8em;
            color: #888;
            margin-top: 5px;
            text-align: center;
            font-style: italic;
        }
        
        .rules-section {
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
            border: 2px solid #ff9800;
            border-radius: 10px;
            padding: 15px;
        }
        
        .rules-section h3 {
            color: #e65100;
            margin-bottom: 10px;
            font-size: 1.1em;
            text-align: center;
        }
        
        .rules-section ul {
            list-style: none;
            padding: 0;
        }
        
        .rules-section li {
            padding: 5px 0;
            padding-left: 20px;
            position: relative;
            line-height: 1.4;
            font-size: 0.9em;
        }
        
        .rules-section li::before {
            content: "‚ö†Ô∏è";
            position: absolute;
            left: 0;
        }
        
        .players-list {
            background: #f8f8f8;
            border-radius: 10px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .players-list h3 {
            margin-bottom: 10px;
            color: #667eea;
        }
        
        .player-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: white;
            margin: 8px 0;
            border-radius: 8px;
            transition: all 0.3s;
        }
        
        .player-item.ready {
            background: #d4f4dd;
            border: 2px solid #4caf50;
        }
        
        .player-item.disconnected {
            opacity: 0.5;
            background: #ffebee;
        }
        
        .player-name {
            font-weight: 600;
            font-size: 0.95em;
        }
        
        .player-status {
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.85em;
            background: white;
        }
        
        .ready-badge {
            background: #4caf50;
            color: white;
        }
        
        .lobby-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .input-group {
            margin: 15px 0;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
            font-size: 0.9em;
        }
        
        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }
        
        .btn-secondary:hover {
            background: #e0e0e0;
        }
        
        .btn-secondary:disabled {
            background: #e0e0e0;
            color: #999;
            cursor: not-allowed !important;
        }
        
        .btn-success {
            background: #4caf50;
            color: white;
        }
        
        .btn-success:hover {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(76, 175, 80, 0.4);
        }
        
        .btn-danger {
            background: #f44336;
            color: white;
        }
        
        /* –ù–û–í–ò–ô LAYOUT –î–õ–Ø –ì–†–ò */
        .game-container {
            background: white;
            height: 100vh;
            display: flex;
            overflow: hidden;
        }
        
        /* –û—Å–Ω–æ–≤–Ω–∞ –∑–æ–Ω–∞ –≥—Ä–∏ */
        .game-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 10px;
        }
        
        /* –í–µ—Ä—Ö–Ω—è —á–∞—Å—Ç–∏–Ω–∞ –∑ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ —Ç–∞ –∫–∞–Ω–≤–∞—Å–æ–º */
        .game-top {
            display: flex;
            gap: 15px;
            margin-bottom: 10px;
        }
        
        /* –õ—ñ–≤–∞ –ø–∞–Ω–µ–ª—å —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤ */
        .tools-panel {
            width: 180px;
            background: #f8f8f8;
            border-radius: 10px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .game-status {
            background: white;
            padding: 8px;
            border-radius: 8px;
        }
        
        .round-info {
            font-size: 0.95em;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 5px;
        }
        
        .help-button {
            padding: 5px 10px;
            background: #2196f3;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8em;
            transition: all 0.3s;
            width: 100%;
        }
        
        .help-button:hover {
            background: #1976d2;
        }
        
        .tools-section h3 {
            color: #667eea;
            margin-bottom: 8px;
            font-size: 0.9em;
        }
        
        .tool-group {
            margin-bottom: 10px;
        }
        
        .tool-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
            font-size: 0.8em;
        }
        
        .tool-buttons {
            display: flex;
            gap: 5px;
        }
        
        .tool-btn {
            flex: 1;
            padding: 5px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1em;
        }
        
        .tool-btn:hover {
            border-color: #667eea;
        }
        
        .tool-btn.active {
            background: #667eea;
            border-color: #667eea;
            color: white;
        }
        
        .color-palette {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 4px;
        }
        
        .color-btn {
            width: 100%;
            aspect-ratio: 1;
            border: 2px solid transparent;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .color-btn:hover {
            transform: scale(1.1);
        }
        
        .color-btn.active {
            border-color: #333;
            box-shadow: 0 0 8px rgba(0,0,0,0.3);
        }
        
        .size-selector {
            display: flex;
            gap: 4px;
        }
        
        .size-btn {
            flex: 1;
            aspect-ratio: 1;
            border: 2px solid #e0e0e0;
            border-radius: 4px;
            background: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .size-btn:hover {
            border-color: #667eea;
        }
        
        .size-btn.active {
            background: #667eea;
            border-color: #667eea;
        }
        
        .size-dot {
            border-radius: 50%;
            background: #333;
        }
        
        .size-btn.active .size-dot {
            background: white;
        }
        
        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-top: auto;
        }
        
        .action-btn {
            padding: 6px;
            border: none;
            border-radius: 5px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.8em;
        }
        
        /* –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞ –∑–æ–Ω–∞ –∑ –∫–∞–Ω–≤–∞—Å–æ–º */
        .canvas-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .task-header {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(255, 215, 0, 0.3);
        }
        
        .task-word {
            font-size: 1.4em;
            font-weight: bold;
            color: #333;
            line-height: 1.3;
            word-wrap: break-word;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–∏–π —à—Ä–∏—Ñ—Ç –¥–ª—è –¥–æ–≤–≥–∏—Ö —Å–ª—ñ–≤ */
        .task-word:has(+ *) {
            font-size: 1.2em;
        }
        
        .my-canvas-wrapper {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
            background: #f8f8f8;
            border-radius: 10px;
        }
        
        .canvas-container {
            background: white;
            border: 3px solid #e0e0e0;
            border-radius: 10px;
            padding: 8px;
            position: relative;
        }
        
        .canvas-container.locked {
            border-color: #f44336;
            background: #ffebee;
        }
        
        .canvas-lock-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(244, 67, 54, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            z-index: 10;
        }
        
        .lock-message {
            background: #f44336;
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
        }
        
        canvas {
            display: block;
            cursor: crosshair;
            border-radius: 8px;
            image-rendering: auto;
        }

        /* Custom cursor –¥–ª—è canvas */
        .custom-cursor {
            position: fixed;
            pointer-events: none;
            z-index: 9999;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.1s, height 0.1s, background-color 0.1s, border 0.1s;
        }

        .custom-cursor.pen-cursor {
            border: 2px solid rgba(0, 0, 0, 0.3);
            opacity: 0.7;
        }

        .custom-cursor.eraser-cursor {
            border-radius: 0 !important;
            background-color: transparent !important;
            border: none !important;
            opacity: 1;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23f44336' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M20 20H7L2.5 15.5C1.83 14.83 1.83 13.67 2.5 13L13 2.5C13.67 1.83 14.83 1.83 15.5 2.5L21.5 8.5C22.17 9.17 22.17 10.33 21.5 11L17 15.5'/%3E%3Cpath d='M13 2.5L21.5 11'/%3E%3C/svg%3E");
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }

        .custom-cursor.fill-cursor {
            border-radius: 0 !important;
            background-color: transparent !important;
            border: none !important;
            opacity: 1;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%234CAF50' stroke='%23388E3C' stroke-width='1.5'%3E%3Cpath d='M12 2 L10 8 L4 10 L10 12 L12 18 L14 12 L20 10 L14 8 Z M12 10 C10.9 10 10 10.9 10 12 L10 18 L14 18 L14 12 C14 10.9 13.1 10 12 10 Z M8 20 L16 20 C17.1 20 18 20.9 18 22 L6 22 C6 20.9 6.9 20 8 20 Z'/%3E%3C/svg%3E");
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }

        /* –°–∫—Ä—ã–≤–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∫—É—Ä—Å–æ—Ä –Ω–∞ –≥–ª–∞–≤–Ω–æ–º canvas */
        .canvas-container canvas {
            cursor: none !important;
        }

        /* Pointer –¥–ª—è canvas'–æ–≤ –¥—Ä—É–≥–∏—Ö –∏–≥—Ä–æ–∫–æ–≤ */
        .drawing-card canvas {
            cursor: pointer !important;
        }
        
        /* –ù–∏–∂–Ω—è —Å–µ–∫—Ü—ñ—è –∑ –∫–∞–Ω–≤–∞—Å–∞–º–∏ —ñ–Ω—à–∏—Ö –≥—Ä–∞–≤—Ü—ñ–≤ */
        .others-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #f0f4f8;
            border-radius: 10px;
            padding: 10px;
            min-height: 0;
        }
        
        .others-header {
            color: #667eea;
            margin-bottom: 8px;
            font-size: 1em;
            font-weight: 600;
        }
        
        .others-content {
            flex: 1;
            overflow-y: auto;
            min-height: 0;
        }
        
        .others-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 12px;
        }
        
        .drawing-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 8px;
            position: relative;
            transition: all 0.3s;
            cursor: pointer;
        }

        .drawing-card.matched {
            border: 3px solid #4caf50;
            background: #f1f8e9;
            cursor: not-allowed;
            box-shadow: 0 0 12px rgba(76, 175, 80, 0.5);
        }

        .drawing-card.selected {
            border: 3px solid #667eea;
            background: #e8eaf6;
            box-shadow: 0 0 12px rgba(102, 126, 234, 0.6);
        }

        .drawing-card.drag-over {
            border: 3px dashed #667eea;
            background: #e3f2fd;
            box-shadow: 0 0 16px rgba(102, 126, 234, 0.8);
            transform: scale(1.02);
        }

        .drawing-card.guessed {
            border-color: #4caf50;
            background: #f1f8e9;
        }

        /* –ù–û–í–ï: –°—Ç–∏–ª—å –¥–ª—è –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è –ø–æ–∫–∞–∑—É –ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π */
        .drawing-card.pending {
            border: 3px solid #2196f3 !important;
            background: #e3f2fd !important;
            box-shadow: 0 0 12px rgba(33, 150, 243, 0.6) !important;
            cursor: not-allowed;
        }

        /* –ù–û–í–ï: –°—Ç–∏–ª—ñ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö/–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π —Ä–∞–º–æ–∫ */
        .drawing-card.correct {
            border: 3px solid #4caf50 !important;
            background: #f1f8e9 !important;
            box-shadow: 0 0 12px rgba(76, 175, 80, 0.6) !important;
            cursor: not-allowed;
        }

        .drawing-card.incorrect {
            border: 3px solid #f44336 !important;
            background: #ffebee !important;
            box-shadow: 0 0 12px rgba(244, 67, 54, 0.6) !important;
            cursor: not-allowed;
        }
        
        .drawing-player-name {
            text-align: center;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 6px;
            font-size: 0.85em;
        }
        
        .guess-controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 3px;
            margin-top: 6px;
        }
        
        .guess-btn {
            padding: 4px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 5px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.8em;
        }
        
        .guess-btn:hover:not(:disabled) {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .guess-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        .guess-btn.selected {
            background: #4caf50;
            color: white;
            border-color: #4caf50;
        }
        
        .guess-btn.used {
            background: #f44336;
            color: white;
            border-color: #f44336;
            text-decoration: line-through;
        }
        
        /* –ü—Ä–∞–≤–∞ –ø–∞–Ω–µ–ª—å –∑ –∫–∞—Ä—Ç–∫–∞–º–∏ */
        .cards-panel {
            width: 450px;
            background: #f8f8f8;
            padding: 10px;
            display: flex;
            flex-direction: row;
            gap: 10px;
            overflow-y: auto;
        }

        /* –°—Ç–æ–≤–ø–µ—Ü—å —Å–ª—ñ–≤ (18 —Å–ª—ñ–≤ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ) */
        .word-column {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .word-card {
            background: white;
            padding: 8px;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }

        .word-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 4px;
        }

        .word-item {
            padding: 8px 10px;
            background: #f0f0f0;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            font-size: 1.2em;
            transition: all 0.3s;
            min-height: 36px;
        }
        
        .word-item:hover {
            background: #e8e8e8;
        }

        .word-item.my-word {
            background: #ffd700;
            font-weight: bold;
        }

        /* –ù–æ–≤—ñ —Å—Ç–∏–ª—ñ –¥–ª—è —Å–∏—Å—Ç–µ–º–∏ –≤—ñ–¥–≥–∞–¥—É–≤–∞–Ω–Ω—è */
        .word-item.used {
            background: #d0d0d0;
            color: #888;
            cursor: not-allowed !important;
            opacity: 0.6;
        }

        .word-item.selected {
            background: #667eea;
            color: white;
            font-weight: bold;
            border: 2px solid #4c6ef5;
            box-shadow: 0 0 8px rgba(102, 126, 234, 0.6);
        }

        /* –ù–û–í–ï: –°—Ç–∏–ª—å –¥–ª—è –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è –ø–æ–∫–∞–∑—É –ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π */
        .word-item.pending {
            background: #2196f3 !important;
            color: white !important;
            font-weight: bold;
            border: 2px solid #1976d2;
            box-shadow: 0 0 10px rgba(33, 150, 243, 0.6);
            opacity: 1 !important;
            cursor: not-allowed !important;
            transition: all 0.4s ease-in-out;
        }

        /* –ù–û–í–ï: –°—Ç–∏–ª—ñ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö/–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π */
        .word-item.correct {
            background: #4caf50 !important;
            color: white !important;
            font-weight: bold;
            border: 2px solid #388e3c;
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.6);
            opacity: 1 !important;
            cursor: not-allowed !important;
            transition: all 0.4s ease-in-out;
        }

        .word-item.incorrect {
            background: #f44336 !important;
            color: white !important;
            font-weight: bold;
            border: 2px solid #d32f2f;
            box-shadow: 0 0 10px rgba(244, 67, 54, 0.6);
            opacity: 1 !important;
            cursor: not-allowed !important;
            transition: all 0.4s ease-in-out;
        }

        .word-item:not(.my-word):not(.used) {
            cursor: grab;
        }

        .word-item:not(.my-word):not(.used):active {
            cursor: grabbing;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }
        
        .word-number {
            background: #667eea;
            color: white;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.65em;
            font-weight: bold;
            flex-shrink: 0;
        }
        
        .word-text {
            flex: 1;
            line-height: 1.2;
            word-break: break-word;
        }
        
        /* –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è –ø—Ä–∞–≤–∏–ª */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-header h2 {
            color: #667eea;
            font-size: 1.5em;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #999;
            transition: color 0.3s;
        }
        
        .modal-close:hover {
            color: #333;
        }
        
        .score-info {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border: 2px solid #2196f3;
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
        }
        
        .score-info h3 {
            color: #1565c0;
            margin-bottom: 15px;
        }
        
        .score-info p {
            line-height: 1.6;
            color: #555;
        }
        
        /* –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ */
        .results-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .results-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .results-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .results-header h2 {
            color: #667eea;
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        .scores-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        .scores-table th {
            background: #667eea;
            color: white;
            padding: 15px;
            text-align: left;
        }
        
        .scores-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .scores-table tr:hover {
            background: #f8f8f8;
        }
        
        .score-change {
            color: #4caf50;
            font-weight: 600;
        }
        
        .winner-announcement {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin: 20px 0;
        }
        
        .winner-announcement h3 {
            font-size: 2.5em;
            color: #333;
            margin-bottom: 10px;
        }
        
        .winner-name {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }
        
        .final-score {
            font-size: 1.5em;
            color: #555;
            margin-top: 10px;
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ñ—Å—Ç—å –¥–ª—è –º–µ–Ω—à–∏—Ö –µ–∫—Ä–∞–Ω—ñ–≤ */
        @media (max-width: 1400px) {
            .cards-panel {
                width: 320px;
            }
            
            .word-item {
                font-size: 0.7em;
            }
        }
        
        @media (max-width: 1200px) {
            .lobby-content {
                grid-template-columns: 1fr;
            }
            
            .game-container {
                flex-direction: column;
            }
            
            .game-main {
                height: auto;
            }
            
            .cards-panel {
                width: 100%;
                flex-direction: row;
                overflow-x: auto;
            }
        }
        
        @media (max-width: 768px) {
            .lobby {
                padding: 20px;
            }
            
            .others-grid {
                grid-template-columns: 1fr;
            }
            
            .copy-success {
                right: auto;
                left: 50%;
                top: -35px;
                transform: translateX(-50%);
            }
        }
        
        .loading {
            text-align: center;
            padding: 40px;
        }
        
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes fadeInUp {
            0% {
                opacity: 0;
                transform: translateY(20px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-section {
            animation: fadeInUp 0.4s ease-out;
            background: #f8f8f8;
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            max-height: 200px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .error-message {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;
        
        // –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è
        const SERVER_URL = window.location.hostname === 'localhost' 
            ? 'http://localhost:3001' 
            : 'https://doodle-prophet-unicorn-canvas-cobra.onrender.com';
        
        // –§—É–Ω–∫—Ü—ñ—ó –¥–ª—è –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è –≤ –±—É—Ñ–µ—Ä –æ–±–º—ñ–Ω—É
        function copyToClipboard(text, onSuccess) {
            // –°—É—á–∞—Å–Ω–∏–π —Å–ø–æ—Å—ñ–± —á–µ—Ä–µ–∑ Clipboard API
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(text)
                    .then(() => onSuccess())
                    .catch(err => {
                        // Fallback –Ω–∞ —Å—Ç–∞—Ä–∏–π –º–µ—Ç–æ–¥
                        fallbackCopyToClipboard(text, onSuccess);
                    });
            } else {
                // Fallback –¥–ª—è —Å—Ç–∞—Ä–∏—Ö –±—Ä–∞—É–∑–µ—Ä—ñ–≤
                fallbackCopyToClipboard(text, onSuccess);
            }
        }
        
        function fallbackCopyToClipboard(text, onSuccess) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = "fixed";
            textArea.style.left = "-999999px";
            textArea.style.top = "-999999px";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                document.execCommand('copy');
                onSuccess();
            } catch (err) {
                console.error('–ù–µ –≤–¥–∞–ª–æ—Å—è —Å–∫–æ–ø—ñ—é–≤–∞—Ç–∏:', err);
            } finally {
                textArea.remove();
            }
        }
        
        // –ì–æ–ª–æ–≤–Ω–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –≥—Ä–∏
        function Game() {
            const [socket, setSocket] = useState(null);
            const [gameState, setGameState] = useState('menu');
            const [roomCode, setRoomCode] = useState('');
            const [playerId, setPlayerId] = useState('');
            const [playerName, setPlayerName] = useState('');
            const [roomData, setRoomData] = useState(null);
            const [roundData, setRoundData] = useState(null);
            const [drawings, setDrawings] = useState({});
            const [myGuesses, setMyGuesses] = useState({});
            const [usedNumbers, setUsedNumbers] = useState(new Set());
            const [myGuessResults, setMyGuessResults] = useState({}); // –ù–û–í–ï: –ó–±–µ—Ä—ñ–≥–∞—î –ø—Ä–∞–≤–∏–ª—å–Ω—ñ—Å—Ç—å –º–æ—ó—Ö –∑–¥–æ–≥–∞–¥–æ–∫
            const [showCorrectAnswers, setShowCorrectAnswers] = useState(false); // –ù–û–í–ï: –ß–∏ –ø–æ–∫–∞–∑—É–≤–∞—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
            const [allCorrectAssignments, setAllCorrectAssignments] = useState({}); // –ù–û–í–ï: –í—Å—ñ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –≤—Å—ñ—Ö –≥—Ä–∞–≤—Ü—ñ–≤
            const [isDrawingLocked, setIsDrawingLocked] = useState(false);
            const [roundResults, setRoundResults] = useState(null);
            const [finalResults, setFinalResults] = useState(null);
            const [error, setError] = useState('');
            const [isHost, setIsHost] = useState(false);
            const [codeCopied, setCodeCopied] = useState(false);
            const [guessProgress, setGuessProgress] = useState({}); // –ù–û–í–ï: –ü—Ä–æ–≥—Ä–µ—Å –∑–¥–æ–≥–∞–¥–æ–∫ –≥—Ä–∞–≤—Ü—ñ–≤ (–¥–ª—è —Ö–æ—Å—Ç–∞)

            // Unicorn Canvas (Fake Artist) state
            const [unicornMode, setUnicornMode] = useState(false); // –ß–∏ –≥—Ä–∞ –≤ —Ä–µ–∂–∏–º—ñ Unicorn Canvas
            const [availableThemes, setAvailableThemes] = useState([]); // –î–æ—Å—Ç—É–ø–Ω—ñ —Ç–µ–º–∏ –¥–ª—è –≤–∏–±–æ—Ä—É
            const [selectedThemes, setSelectedThemes] = useState([]); // –û–±—Ä–∞–Ω—ñ —Ç–µ–º–∏ –≥—Ä–∞–≤—Ü–µ–º
            const [playerCard, setPlayerCard] = useState(null); // –ö–∞—Ä—Ç–∫–∞ –≥—Ä–∞–≤—Ü—è {word: string, isFake: boolean}
            const [currentTheme, setCurrentTheme] = useState(null); // –ü–æ—Ç–æ—á–Ω–∞ —Ç–µ–º–∞ —Ä–∞—É–Ω–¥—É
            const [sharedDrawing, setSharedDrawing] = useState([]); // –°–ø—ñ–ª—å–Ω–∏–π –∫–∞–Ω–≤–∞—Å
            const [turnOrder, setTurnOrder] = useState([]); // –ü–æ—Ä—è–¥–æ–∫ —Ö–æ–¥—ñ–≤
            const [currentTurnIndex, setCurrentTurnIndex] = useState(0); // –Ü–Ω–¥–µ–∫—Å –ø–æ—Ç–æ—á–Ω–æ–≥–æ –≥—Ä–∞–≤—Ü—è
            const [currentDrawingRound, setCurrentDrawingRound] = useState(1); // 1 –∞–±–æ 2
            const [unicornRoundResults, setUnicornRoundResults] = useState(null); // –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Ä–∞—É–Ω–¥—É
            const [fakeArtistGuess, setFakeArtistGuess] = useState(''); // –ó–¥–æ–≥–∞–¥–∫–∞ –ø—ñ–¥—Ä–æ–±–Ω–æ–≥–æ
            const [themeSelectionTimeLeft, setThemeSelectionTimeLeft] = useState(30); // –¢–∞–π–º–µ—Ä –≤–∏–±–æ—Ä—É —Ç–µ–º

            // –í–ò–ü–†–ê–í–õ–ï–ù–û: –î–∏–Ω–∞–º—ñ—á–Ω—ñ —Ç–∞–π–º–µ—Ä–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö —Ñ–∞–∑
            const [drawingTimeLeft, setDrawingTimeLeft] = useState(60); // –¢–∞–π–º–µ—Ä —Ä–∏—Å—É–≤–∞–Ω–Ω—è
            const [votingTimeLeft, setVotingTimeLeft] = useState(30); // –¢–∞–π–º–µ—Ä –≥–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è
            const [guessingTimeLeft, setGuessingTimeLeft] = useState(60); // –¢–∞–π–º–µ—Ä –≤—ñ–¥–≥–∞–¥—É–≤–∞–Ω–Ω—è

            // Canvas refs and state –¥–ª—è –º–∞–ª—é–≤–∞–Ω–Ω—è
            const canvasRef = useRef(null);
            const [isDrawing, setIsDrawing] = useState(false);
            const [currentStroke, setCurrentStroke] = useState([]);

            // –í–ò–ü–†–ê–í–õ–ï–ù–û: useRef –¥–ª—è Unicorn Canvas (–≤–∏–Ω–µ—Å–µ–Ω—ñ –∑ —É–º–æ–≤–Ω–æ–≥–æ –±–ª–æ–∫—É)
            const canvasBoundsRef = useRef(null);
            const strokeBufferRef = useRef([]);
            const lastXRef = useRef(null);
            const lastYRef = useRef(null);
            const customCursorRef = useRef(null);
            const ctxRef = useRef(null);
            const lastDrawnIndexRef = useRef(0); // –Ü–Ω–¥–µ–∫—Å –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ –Ω–∞–º–∞–ª—å–æ–≤–∞–Ω–æ–≥–æ —à—Ç—Ä–∏—Ö—É

            // State –¥–ª—è –≥–æ–ª–æ—Å—É–≤–∞–Ω—å –≤ Unicorn Canvas
            const [myVoteForFake, setMyVoteForFake] = useState(null);
            const [fakeGuessInput, setFakeGuessInput] = useState('');
            const [myVoteForAnswer, setMyVoteForAnswer] = useState(null);
            const [showRules, setShowRules] = useState(false);

            // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è Socket.io
            useEffect(() => {
                const newSocket = io(SERVER_URL);
                
                newSocket.on('connect', () => {
                    console.log('Connected to server');
                });
                
                newSocket.on('room_created', ({ roomCode, playerId, state }) => {
                    setRoomCode(roomCode);
                    setPlayerId(playerId);
                    setRoomData(state);
                    setGameState('lobby');
                    setIsHost(true);
                    localStorage.setItem('gameSession', JSON.stringify({ roomCode, playerId, playerName }));
                });
                
                newSocket.on('joined_room', ({ roomCode, playerId, state }) => {
                    setRoomCode(roomCode);
                    setPlayerId(playerId);
                    setRoomData(state);
                    setGameState('lobby');
                    setIsHost(state.hostId === playerId);
                    // –í–ò–ü–†–ê–í–õ–ï–ù–û: –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É—î–º–æ –ø–æ–∫–∞–∑ –ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π
                    if (state?.answersRevealed !== undefined) {
                        setShowCorrectAnswers(state.answersRevealed);
                    }
                    localStorage.setItem('gameSession', JSON.stringify({ roomCode, playerId, playerName }));
                });
                
                newSocket.on('player_joined', (state) => {
                    setRoomData(state);
                    // –í–ò–ü–†–ê–í–õ–ï–ù–û: –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É—î–º–æ –ø–æ–∫–∞–∑ –ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π
                    if (state?.answersRevealed !== undefined) {
                        setShowCorrectAnswers(state.answersRevealed);
                    }
                });

                newSocket.on('player_ready_changed', (state) => {
                    setRoomData(state);
                    // –í–ò–ü–†–ê–í–õ–ï–ù–û: –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É—î–º–æ –ø–æ–∫–∞–∑ –ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π
                    if (state?.answersRevealed !== undefined) {
                        setShowCorrectAnswers(state.answersRevealed);
                    }
                });
                
                newSocket.on('round_started', (data) => {
                    setRoundData(data);
                    setGameState('playing');
                    setDrawings({});
                    setMyGuesses({});
                    setUsedNumbers(new Set());
                    setMyGuessResults({}); // –ù–û–í–ï: –û—á–∏—â–∞—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –∑–¥–æ–≥–∞–¥–æ–∫
                    setShowCorrectAnswers(false); // –ù–û–í–ï: –°–∫–∏–¥–∞—î–º–æ –ø–æ–∫–∞–∑ –ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π
                    setAllCorrectAssignments({}); // –ù–û–í–ï: –û—á–∏—â–∞—î–º–æ –≤—Å—ñ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
                    setGuessProgress({}); // –ù–û–í–ï: –û—á–∏—â–∞—î–º–æ –ø—Ä–æ–≥—Ä–µ—Å –∑–¥–æ–≥–∞–¥–æ–∫ –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ä–∞—É–Ω–¥—É
                    setRoundStartTime(null); // –ù–û–í–ï: –°–ø–æ—á–∞—Ç–∫—É –æ—á–∏—â–∞—î–º–æ —á–∞—Å —Å—Ç–∞—Ä—Ç—É
                    setIsDrawingLocked(false);
                    // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –Ω–æ–≤–∏–π roundStartTime –ø—ñ—Å–ª—è –æ—á–∏—â–µ–Ω–Ω—è
                    if (data?.roundStartTime) {
                        setTimeout(() => setRoundStartTime(data.roundStartTime), 0);
                    }
                });
                
                newSocket.on('drawing_updated', ({ playerId, strokes }) => {
                    setDrawings(prev => ({
                        ...prev,
                        [playerId]: [...(prev[playerId] || []), ...strokes]
                    }));
                });
                
                newSocket.on('canvas_cleared', ({ playerId }) => {
                    setDrawings(prev => ({
                        ...prev,
                        [playerId]: []
                    }));
                });
                
                newSocket.on('drawing_locked', ({ playerId: lockedPlayerId }) => {
                    if (lockedPlayerId === playerId) {
                        setIsDrawingLocked(true);
                    }
                });

                newSocket.on('guess_accepted', ({ targetId, number, letter, correct, targetAssignment }) => {
                    console.log('‚úÖ guess_accepted:', { targetId, number, letter, correct, targetAssignment }); // DEBUG
                    setMyGuesses(prev => ({ ...prev, [targetId]: { letter, number } }));
                    setUsedNumbers(prev => new Set([...prev, `${letter}${number}`]));

                    // –ù–ï –æ–±–Ω–æ–≤–ª—è–µ–º wordAssignments - –æ—Å—Ç–∞–≤–ª—è–µ–º –≤—ã–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–π –ø–æ–¥—Å–∫–∞–∑–∫–∏
                    // –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –≤ myGuessResults
                    setMyGuessResults(prev => {
                        const newResults = {
                            ...prev,
                            [targetId]: {
                                letter,
                                number,
                                correct,
                                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ assignment –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
                                targetAssignment: targetAssignment
                            }
                        };
                        console.log('üìä myGuessResults updated:', newResults);
                        return newResults;
                    });
                });

                // –ù–û–í–ï: –û–±—Ä–æ–±–Ω–∏–∫ –ø–æ–∫–∞–∑—É –ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π
                newSocket.on('answers_revealed', ({ state, assignments }) => {
                    console.log('üì¢ Answers revealed by host', state, assignments);
                    if (state?.answersRevealed) {
                        setShowCorrectAnswers(true);
                    }
                    if (assignments) {
                        setAllCorrectAssignments(assignments);
                        console.log('üìã All correct assignments:', assignments);
                    }
                });

                // –ù–û–í–ï: –û–±—Ä–æ–±–Ω–∏–∫ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–æ–≥—Ä–µ—Å—É –∑–¥–æ–≥–∞–¥–æ–∫ (—Ç—ñ–ª—å–∫–∏ –¥–ª—è —Ö–æ—Å—Ç–∞)
                newSocket.on('guess_progress_update', ({ progress }) => {
                    setGuessProgress(progress);
                    console.log('üìä Guess progress updated:', progress);
                });

                newSocket.on('round_ended', (results) => {
                    setRoundResults(results);
                    setGameState('round_end');
                });
                
                newSocket.on('game_ended', (results) => {
                    setFinalResults(results);
                    setGameState('game_end');
                });
                
                newSocket.on('game_reset', (state) => {
                    setRoomData(state);
                    setGameState('lobby');
                    setRoundData(null);
                    setRoundResults(null);
                    setFinalResults(null);
                    // –í–ò–ü–†–ê–í–õ–ï–ù–û: –û—á–∏—â–∞—î–º–æ –≤–µ—Å—å state Unicorn Canvas
                    setAvailableThemes([]);
                    setSelectedThemes([]);
                    setPlayerCard(null);
                    setCurrentTheme(null);
                    setSharedDrawing([]);
                    setTurnOrder([]);
                    setCurrentTurnIndex(0);
                    setCurrentDrawingRound(1);
                    setUnicornRoundResults(null);
                    setFakeArtistGuess('');
                    setMyVoteForFake(null);
                    setFakeGuessInput('');
                    setMyVoteForAnswer(null);
                    setIsDrawing(false);
                    setCurrentStroke([]);
                    // –û—á–∏—â–∞—î–º–æ –±—É—Ñ–µ—Ä —à—Ç—Ä–∏—Ö—ñ–≤
                    if (strokeBufferRef.current) {
                        strokeBufferRef.current = [];
                    }
                });
                
                newSocket.on('error', ({ message }) => {
                    setError(message);
                });
                
                newSocket.on('player_disconnected', ({ playerId: disconnectedId, state }) => {
                    setRoomData(state);
                });

                // ========== UNICORN CANVAS EVENTS ==========

                newSocket.on('theme_selection_started', ({ availableThemes, state }) => {
                    console.log('Theme selection started', availableThemes);
                    setUnicornMode(true);
                    setAvailableThemes(availableThemes);
                    setGameState('theme_selection');
                    setRoomData(state);
                    setThemeSelectionTimeLeft(20); // –°–∫–∏–¥–∞—î–º–æ —Ç–∞–π–º–µ—Ä
                });

                newSocket.on('round_started_unicorn', ({ round, theme, card, turnOrder, currentTurnIndex, currentDrawingRound, state }) => {
                    console.log('Unicorn round started', { round, theme, card });
                    setCurrentTheme(theme);
                    setPlayerCard(card);
                    setTurnOrder(turnOrder);
                    setCurrentTurnIndex(currentTurnIndex);
                    setCurrentDrawingRound(currentDrawingRound);
                    setSharedDrawing([]);
                    // –í–ò–ü–†–ê–í–õ–ï–ù–û: –°–∫–∏–¥–∞—î–º–æ —ñ–Ω–¥–µ–∫—Å –ø—Ä–∏ –Ω–æ–≤–æ–º—É —Ä–∞—É–Ω–¥—ñ
                    lastDrawnIndexRef.current = 0;
                    // –í–ò–ü–†–ê–í–õ–ï–ù–û: –ù–ï –æ—á–∏—â–∞—î–º–æ —Ç—É—Ç - useEffect –∑—Ä–æ–±–∏—Ç—å —Ü–µ –ø—Ä–∏ —Ä–µ—ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó
                    setGameState('unicorn_drawing');
                    setRoomData(state);
                });

                newSocket.on('drawing_stroke_added', ({ stroke, sharedDrawing }) => {
                    setSharedDrawing(sharedDrawing);
                });

                // –í–ò–ü–†–ê–í–õ–ï–ù–û: –ë–∞—Ç—á–∏–Ω–≥ —à—Ç—Ä–∏—Ö—ñ–≤ (–æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è)
                newSocket.on('drawing_strokes_added', ({ strokes, sharedDrawing }) => {
                    setSharedDrawing(sharedDrawing);
                });

                newSocket.on('next_turn', ({ currentTurnIndex, currentDrawingRound, currentPlayerId, state }) => {
                    setCurrentTurnIndex(currentTurnIndex);
                    setCurrentDrawingRound(currentDrawingRound);
                    setRoomData(state);
                });

                newSocket.on('voting_for_fake_started', ({ state }) => {
                    console.log('Voting for fake started');
                    setGameState('voting_fake');
                    setRoomData(state);
                });

                newSocket.on('fake_guessing_started', ({ fakeArtistId, state }) => {
                    console.log('Fake guessing started', fakeArtistId);
                    setGameState('fake_guessing');
                    setRoomData(state);
                });

                newSocket.on('voting_answer_started', ({ fakeGuess, word, state }) => {
                    console.log('Voting answer started', { fakeGuess, word });
                    setFakeArtistGuess(fakeGuess);
                    setGameState('voting_answer');
                    setRoomData(state);
                });

                newSocket.on('round_ended_unicorn', ({ results, state }) => {
                    console.log('Unicorn round ended', results);
                    setUnicornRoundResults(results);
                    setGameState('unicorn_round_end');
                    setRoomData(state);
                });

                // ========== END UNICORN CANVAS EVENTS ==========

                setSocket(newSocket);
                
                // –°–ø—Ä–æ–±–∞ –≤—ñ–¥–Ω–æ–≤–∏—Ç–∏ —Å–µ—Å—ñ—é
                const savedSession = localStorage.getItem('gameSession');
                if (savedSession) {
                    const { roomCode: savedRoom, playerId: savedId, playerName: savedName } = JSON.parse(savedSession);
                    if (savedRoom && savedId && savedName) {
                        setPlayerName(savedName);
                        newSocket.emit('join_room', { 
                            roomCode: savedRoom, 
                            playerName: savedName, 
                            playerId: savedId 
                        });
                    }
                }
                
                return () => {
                    newSocket.close();
                };
            }, []);

            // –¢–∞–π–º–µ—Ä –≤–∏–±–æ—Ä—É —Ç–µ–º
            useEffect(() => {
                if (gameState === 'theme_selection') {
                    const timer = setInterval(() => {
                        setThemeSelectionTimeLeft(prev => {
                            if (prev <= 0) return 0;
                            return prev - 1;
                        });
                    }, 1000);

                    return () => clearInterval(timer);
                }
            }, [gameState]);

            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –≤–∏–±—ñ—Ä –∫–æ–ª–∏ —Ç–∞–π–º–µ—Ä –∑–∞–∫—ñ–Ω—á—É—î—Ç—å—Å—è
            useEffect(() => {
                if (gameState === 'theme_selection' && themeSelectionTimeLeft === 0 && socket) {
                    console.log('Auto-submitting themes:', selectedThemes);
                    socket.emit('submit_theme_votes', { selectedThemes });
                }
            }, [gameState, themeSelectionTimeLeft, socket, selectedThemes]);

            // –í–ò–ü–†–ê–í–õ–ï–ù–û: –¢–∞–π–º–µ—Ä —Ñ–∞–∑–∏ –º–∞–ª—é–≤–∞–Ω–Ω—è
            useEffect(() => {
                if (gameState === 'unicorn_drawing') {
                    setDrawingTimeLeft(60); // –°–∫–∏–¥–∞—î–º–æ –ø—Ä–∏ –≤—Ö–æ–¥—ñ –≤ —Ñ–∞–∑—É
                    const timer = setInterval(() => {
                        setDrawingTimeLeft(prev => {
                            if (prev <= 0) return 0;
                            return prev - 1;
                        });
                    }, 1000);
                    return () => clearInterval(timer);
                }
            }, [gameState, currentTurnIndex]); // –°–∫–∏–¥–∞—Ç–∏ –ø—Ä–∏ –∑–º—ñ–Ω—ñ —Ö–æ–¥—É

            // –í–ò–ü–†–ê–í–õ–ï–ù–û: –¢–∞–π–º–µ—Ä –≥–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è
            useEffect(() => {
                if (gameState === 'voting_fake') {
                    setVotingTimeLeft(30); // –°–∫–∏–¥–∞—î–º–æ –ø—Ä–∏ –≤—Ö–æ–¥—ñ –≤ —Ñ–∞–∑—É
                    const timer = setInterval(() => {
                        setVotingTimeLeft(prev => {
                            if (prev <= 0) return 0;
                            return prev - 1;
                        });
                    }, 1000);
                    return () => clearInterval(timer);
                }
            }, [gameState]);

            // –í–ò–ü–†–ê–í–õ–ï–ù–û: –¢–∞–π–º–µ—Ä –≤—ñ–¥–≥–∞–¥—É–≤–∞–Ω–Ω—è
            useEffect(() => {
                if (gameState === 'fake_guessing') {
                    setGuessingTimeLeft(30); // –°–∫–∏–¥–∞—î–º–æ –ø—Ä–∏ –≤—Ö–æ–¥—ñ –≤ —Ñ–∞–∑—É
                    const timer = setInterval(() => {
                        setGuessingTimeLeft(prev => {
                            if (prev <= 0) return 0;
                            return prev - 1;
                        });
                    }, 1000);
                    return () => clearInterval(timer);
                }
            }, [gameState]);

            // –í–ò–ü–†–ê–í–õ–ï–ù–û: –Ü–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–µ –º–∞–ª—é–≤–∞–Ω–Ω—è - —Ç—ñ–ª—å–∫–∏ –ù–û–í–Ü —à—Ç—Ä–∏—Ö–∏!
            useEffect(() => {
                if (gameState !== 'unicorn_drawing' || !ctxRef.current) return;

                const canvas = canvasRef.current;
                if (!canvas) return;

                const ctx = ctxRef.current;

                // –ú–∞–ª—é—î–º–æ —Ç—ñ–ª—å–∫–∏ –ù–û–í–Ü —à—Ç—Ä–∏—Ö–∏ (–≤—ñ–¥ lastDrawnIndexRef –¥–æ –∫—ñ–Ω—Ü—è)
                for (let i = lastDrawnIndexRef.current; i < sharedDrawing.length; i++) {
                    const stroke = sharedDrawing[i];

                    // –í–ò–ü–†–ê–í–õ–ï–ù–û: –ü—Ä–æ–ø—É—Å–∫–∞—î–º–æ —Å–≤–æ—ó –≤–ª–∞—Å–Ω—ñ —à—Ç—Ä–∏—Ö–∏ (–≤–æ–Ω–∏ –≤–∂–µ –Ω–∞–º–∞–ª—å–æ–≤–∞–Ω—ñ –ª–æ–∫–∞–ª—å–Ω–æ)
                    if (stroke.playerId === playerId) {
                        continue;
                    }

                    if (stroke.type === 'fill') {
                        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ª–∏–≤–∫–∏ –≤—Å–µ–≥–æ canvas
                        ctx.fillStyle = stroke.color || '#FFFFFF';
                        ctx.fillRect(0, 0, canvas.width, canvas.height);
                    } else if (stroke.type === 'start') {
                        ctx.beginPath();
                        ctx.strokeStyle = stroke.color || '#000000';
                        ctx.fillStyle = stroke.color || '#000000';
                        ctx.lineWidth = 3;
                        ctx.lineCap = 'round';
                        ctx.lineJoin = 'round';
                        const x = stroke.x * canvas.width;
                        const y = stroke.y * canvas.height;
                        // –ú–∞–ª—é—î–º–æ –ø–æ—á–∞—Ç–∫–æ–≤—É —Ç–æ—á–∫—É
                        ctx.arc(x, y, 1.5, 0, 2 * Math.PI);
                        ctx.fill();
                        ctx.beginPath();
                        ctx.moveTo(x, y);
                    } else if (stroke.type === 'draw') {
                        const x = stroke.x * canvas.width;
                        const y = stroke.y * canvas.height;
                        ctx.lineTo(x, y);
                        ctx.stroke();
                        ctx.beginPath();
                        ctx.moveTo(x, y);
                    }
                }

                // –û–Ω–æ–≤–ª—é—î–º–æ —ñ–Ω–¥–µ–∫—Å –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ –Ω–∞–º–∞–ª—å–æ–≤–∞–Ω–æ–≥–æ —à—Ç—Ä–∏—Ö—É
                lastDrawnIndexRef.current = sharedDrawing.length;
            }, [gameState, sharedDrawing]);

            // –°–∫–∏–¥–∞–Ω–Ω—è —Å—Ç–∞–Ω—É –º–∞–ª—é–≤–∞–Ω–Ω—è –ø—Ä–∏ –∑–º—ñ–Ω—ñ gameState
            useEffect(() => {
                if (gameState !== 'unicorn_drawing') {
                    setIsDrawing(false);
                    setCurrentStroke([]);
                }
                if (gameState !== 'voting_fake') {
                    setMyVoteForFake(null);
                }
                if (gameState !== 'fake_guessing') {
                    setFakeGuessInput('');
                }
                if (gameState !== 'voting_answer') {
                    setMyVoteForAnswer(null);
                }
            }, [gameState]);

            // –í–ò–ü–†–ê–í–õ–ï–ù–û: –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è canvas –¥–ª—è Unicorn Canvas
            useEffect(() => {
                if (gameState !== 'unicorn_drawing' && gameState !== 'voting_fake' && gameState !== 'fake_guessing' && gameState !== 'voting_answer') return;

                const canvas = canvasRef.current;
                if (!canvas) return;

                // –í–ò–ü–†–ê–í–õ–ï–ù–û: –ó–∞–≤–∂–¥–∏ —Ä–µ—ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ –ø—Ä–∏ –≤—Ö–æ–¥—ñ —É —Ñ–∞–∑—É –º–∞–ª—é–≤–∞–Ω–Ω—è
                if (gameState === 'unicorn_drawing' || !ctxRef.current) {
                    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç –∑ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è–º–∏
                    const ctx = canvas.getContext('2d', {
                        alpha: false,  // –í–ò–ü–†–ê–í–õ–ï–ù–û: false –¥–ª—è –±—ñ–ª–æ–≥–æ —Ñ–æ–Ω—É!
                        desynchronized: true  // –ö–†–ò–¢–ò–ß–ù–û –¥–ª—è performance!
                    });
                    ctxRef.current = ctx;

                    canvas.width = 800;
                    canvas.height = 600;

                    ctx.lineCap = 'round';
                    ctx.lineJoin = 'round';
                    ctx.imageSmoothingEnabled = true;
                    ctx.imageSmoothingQuality = 'high';

                    // –í–ò–ü–†–ê–í–õ–ï–ù–û: –ó–∞–ª–∏–≤–∞—î–º–æ –±—ñ–ª–∏–º —Ñ–æ–Ω–æ–º!
                    ctx.fillStyle = '#FFFFFF';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);

                    // –ö–µ—à—É—î–º–æ bounds
                    const updateBounds = () => {
                        canvasBoundsRef.current = canvas.getBoundingClientRect();
                    };
                    updateBounds();
                    window.addEventListener('resize', updateBounds);
                    return () => window.removeEventListener('resize', updateBounds);
                }
            }, [gameState]);

            // –í–ò–ü–†–ê–í–õ–ï–ù–û: –ë–∞—Ç—á–∏–Ω–≥ –¥–ª—è socket.emit —è–∫ –≤ Doodle Prophet
            useEffect(() => {
                if (gameState !== 'unicorn_drawing' && gameState !== 'voting_fake' && gameState !== 'fake_guessing' && gameState !== 'voting_answer') return;

                let animationFrameId;

                const sendStrokes = () => {
                    if (strokeBufferRef.current.length > 0 && socket) {
                        socket.emit('unicorn_drawing_strokes', {
                            strokes: strokeBufferRef.current
                        });
                        strokeBufferRef.current = [];
                    }
                    animationFrameId = requestAnimationFrame(sendStrokes);
                };

                animationFrameId = requestAnimationFrame(sendStrokes);

                return () => {
                    cancelAnimationFrame(animationFrameId);
                };
            }, [gameState, socket]);

            // –í–ò–ü–†–ê–í–õ–ï–ù–û: useCallback –¥–ª—è –∫—É—Ä—Å–æ—Ä–∞ (–≤–∏–Ω–µ—Å–µ–Ω–æ –∑ —É–º–æ–≤–Ω–æ–≥–æ –±–ª–æ–∫—É)
            const updateCustomCursor = useCallback((x, y) => {
                if (!customCursorRef.current) return;
                customCursorRef.current.style.left = `${x}px`;
                customCursorRef.current.style.top = `${y}px`;
            }, []);

            // –û–±—Ä–æ–±–Ω–∏–∫–∏ –ø–æ–¥—ñ–π
            const createRoom = () => {
                if (playerName.trim() && socket) {
                    socket.emit('create_room', { playerName });
                }
            };
            
            const joinRoom = () => {
                if (playerName.trim() && roomCode.trim() && socket) {
                    socket.emit('join_room', { roomCode: roomCode.toUpperCase(), playerName });
                }
            };
            
            const toggleReady = () => {
                if (socket && roomData) {
                    const isReady = roomData.players.find(p => p.id === playerId)?.ready;
                    socket.emit('player_ready', { ready: !isReady });
                }
            };
            
            const startGame = () => {
                if (socket && isHost) {
                    socket.emit('start_game');
                }
            };

            const startUnicornCanvas = () => {
                if (socket && isHost) {
                    socket.emit('start_unicorn_canvas');
                }
            };

            const makeGuess = (targetId, number, letter) => {
                if (socket && !myGuesses[targetId]) {
                    socket.emit('make_guess', { targetId, number, letter });
                }
            };

            const endRound = () => {
                if (socket && isHost) {
                    socket.emit('end_round');
                }
            };

            const nextRound = () => {
                if (socket && isHost) {
                    socket.emit('next_round');
                }
            };
            
            const newGame = () => {
                if (socket && isHost) {
                    socket.emit('new_game');
                }
            };
            
            const handleCopyCode = () => {
                copyToClipboard(roomCode, () => {
                    setCodeCopied(true);
                    setTimeout(() => setCodeCopied(false), 2000);
                });
            };
            
            // –†–µ–Ω–¥–µ—Ä —Ä—ñ–∑–Ω–∏—Ö –µ–∫—Ä–∞–Ω—ñ–≤
            if (gameState === 'menu') {
                const hasRoomCode = roomCode.trim().length > 0;
                const hasPlayerName = playerName.trim().length > 0;
                const canJoin = hasRoomCode && hasPlayerName;
                
                return (
                    <div className="lobby-container">
                        <div className="lobby">
                            <h1>Doodle Prophet Unicorn Canvas Cobra</h1>
                            
                            {error && <div className="error-message">{error}</div>}
                            
                            <div className="input-group">
                                <label>–í–∞—à–µ —ñ–º'—è:</label>
                                <input
                                    type="text"
                                    value={playerName}
                                    onChange={(e) => setPlayerName(e.target.value)}
                                    placeholder={hasRoomCode && !hasPlayerName ? "–í–≤–µ–¥—ñ—Ç—å —Å–≤–æ—î —ñ–º'—è –¢–£–¢" : "Captain Obvious"}
                                    maxLength={15}
                                    style={hasRoomCode && !hasPlayerName ? {borderColor: '#ff9800', borderWidth: '2px'} : {}}
                                />
                            </div>
                            
                            <button 
                                className="btn btn-primary"
                                onClick={createRoom}
                                disabled={!playerName.trim()}
                                style={{ width: '100%', marginBottom: '15px' }}
                            >
                                –°—Ç–≤–æ—Ä–∏—Ç–∏ –∫—ñ–º–Ω–∞—Ç—É
                            </button>
                            
                            <div style={{ margin: '15px 0', textAlign: 'center' }}>
                                <span style={{ color: '#999' }}>‚Äî –∞–±–æ ‚Äî</span>
                            </div>
                            
                            <div className="input-group">
                                <label>–ö–æ–¥ –∫—ñ–º–Ω–∞—Ç–∏:</label>
                                <input
                                    type="text"
                                    value={roomCode}
                                    onChange={(e) => setRoomCode(e.target.value.toUpperCase())}
                                    placeholder="–í–≤–µ–¥—ñ—Ç—å –∫–æ–¥ –∫—ñ–º–Ω–∞—Ç–∏"
                                    maxLength={6}
                                />
                            </div>
                            
                            <button 
                                className={`btn ${canJoin ? 'btn-success' : 'btn-secondary'}`}
                                onClick={joinRoom}
                                disabled={!canJoin}
                                style={{ width: '100%' }}
                            >
                                –ü—Ä–∏—î–¥–Ω–∞—Ç–∏—Å—è –¥–æ –∫—ñ–º–Ω–∞—Ç–∏
                            </button>
                        </div>
                    </div>
                );
            }
            
            if (gameState === 'lobby') {
                return (
                    <div className="lobby-container">
                        <div className="lobby">
                            <h1>–ö—ñ–º–Ω–∞—Ç–∞ –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è</h1>
                            
                            <div className="lobby-content">
                                <div className="lobby-left">
                                    <div className="room-code">
                                        <h2>–ö–æ–¥ –∫—ñ–º–Ω–∞—Ç–∏:</h2>
                                        <div 
                                            className="code clickable-code"
                                            onClick={handleCopyCode}
                                            title="–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å —â–æ–± —Å–∫–æ–ø—ñ—é–≤–∞—Ç–∏"
                                        >
                                            {roomCode}
                                            {codeCopied && <span className="copy-success">‚úì –°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!</span>}
                                        </div>
                                        <div className="code-hint">–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –Ω–∞ –∫–æ–¥ —â–æ–± —Å–∫–æ–ø—ñ—é–≤–∞—Ç–∏</div>
                                    </div>
                                    
                                    <div className="rules-section">
                                        <h3>–ü–†–ê–í–ò–õ–ê –ú–ê–õ–Æ–í–ê–ù–ù–Ø</h3>
                                        <ul>
                                            <li>–ù–ï –º–∞–ª—é–π—Ç–µ –ª—ñ—Ç–µ—Ä–∏ —á–∏ —Ü–∏—Ñ—Ä–∏. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, —è–∫—â–æ —É –≤–∞—Å —Å–ª–æ–≤–æ "–∫–Ω–∏–≥–∞", –≤–∏ –Ω–µ –º–æ–∂–µ—Ç–µ –Ω–∞–º–∞–ª—é–≤–∞—Ç–∏ –ª—ñ—Ç–µ—Ä–∏ –ö-–ù-–ò-–ì-–ê</li>
                                            <li>–ù–ï –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Å–∏–º–≤–æ–ª–∏ —á–∏ —Ü–∏—Ñ—Ä–∏, —è–∫—ñ –ø—Ä—è–º–æ –≤–∫–∞–∑—É—é—Ç—å –Ω–∞ –≤–∞—à–µ –∑–∞–≤–¥–∞–Ω–Ω—è.</li>
                                            <li>–í–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç–∏ —ñ–¥–µ—é, —Å—É—Ç—å, –∫–æ–Ω—Ü–µ–ø—Ü—ñ—é —Å–ª–æ–≤–∞ —á–µ—Ä–µ–∑ –≤—ñ–∑—É–∞–ª—å–Ω—ñ –æ–±—Ä–∞–∑–∏.</li>
                                        </ul>
                                    </div>
                                </div>
                                
                                <div className="lobby-right">
                                    <div className="players-list">
                                        <h3>–ì—Ä–∞–≤—Ü—ñ ({roomData?.players?.length || 0}/12):</h3>
                                        {roomData?.players?.map(player => (
                                            <div
                                                key={player.id}
                                                className={`player-item ${player.ready ? 'ready' : ''} ${!player.connected ? 'disconnected' : ''}`}
                                            >
                                                <span className="player-name" style={{ color: player.color || '#000', fontWeight: 'bold' }}>
                                                    {player.name}
                                                    {player.id === playerId && ' (–í–∏)'}
                                                    {player.id === roomData.hostId && ' üëë'}
                                                </span>
                                                <span className={`player-status ${player.ready ? 'ready-badge' : ''}`}>
                                                    {!player.connected ? '–í—ñ–¥–∫–ª.' : player.ready ? '–ì–æ—Ç–æ–≤–∏–π' : '–ù–µ –≥–æ—Ç–æ–≤–∏–π'}
                                                </span>
                                            </div>
                                        ))}
                                    </div>
                                    
                                    <div className="lobby-buttons">
                                        <button 
                                            className={`btn ${roomData?.players?.find(p => p.id === playerId)?.ready ? 'btn-danger' : 'btn-success'}`}
                                            onClick={toggleReady}
                                        >
                                            {roomData?.players?.find(p => p.id === playerId)?.ready ? '–ù–µ –≥–æ—Ç–æ–≤–∏–π' : '–ì–æ—Ç–æ–≤–∏–π'}
                                        </button>
                                        
                                        {isHost && (
                                            <>
                                                <button
                                                    className="btn btn-primary"
                                                    onClick={startGame}
                                                    disabled={roomData?.players?.length < 3 || !roomData?.players?.every(p => p.ready)}
                                                >
                                                    {roomData?.players?.length < 3 ? '–ú—ñ–Ω—ñ–º—É–º 3' : 'Doodle Prophet'}
                                                </button>
                                                <button
                                                    className="btn btn-primary"
                                                    onClick={startUnicornCanvas}
                                                    disabled={roomData?.players?.length < 3 || !roomData?.players?.every(p => p.ready)}
                                                >
                                                    {roomData?.players?.length < 3 ? '–ú—ñ–Ω—ñ–º—É–º 3' : 'Unicorn Canvas'}
                                                </button>
                                            </>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // UNICORN CANVAS: –í–∏–±—ñ—Ä —Ç–µ–º
            if (gameState === 'theme_selection') {
                const handleThemeToggle = (theme) => {
                    setSelectedThemes(prev => {
                        if (prev.includes(theme)) {
                            return prev.filter(t => t !== theme);
                        } else if (prev.length < 5) {
                            return [...prev, theme];
                        }
                        return prev;
                    });
                };

                return (
                    <div className="lobby-container">
                        <div className="lobby">
                            <h1>–û–±–µ—Ä—ñ—Ç—å 5 —Ç–µ–º –¥–ª—è –≥—Ä–∏</h1>
                            <p>–¢–∞–π–º–µ—Ä: {themeSelectionTimeLeft} —Å–µ–∫.</p>
                            <p>–û–±—Ä–∞–Ω–æ: {selectedThemes.length}/5</p>
                            <p style={{color: '#999', fontSize: '14px', marginTop: '5px'}}>
                                –¢–µ–º–∏ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∫–æ–ª–∏ –∑–∞–∫—ñ–Ω—á–∏—Ç—å—Å—è —Ç–∞–π–º–µ—Ä
                            </p>

                            <div className="theme-grid" style={{
                                display: 'grid',
                                gridTemplateColumns: 'repeat(4, 1fr)',
                                gap: '10px',
                                maxWidth: '800px',
                                margin: '20px auto'
                            }}>
                                {availableThemes.map(theme => (
                                    <button
                                        key={theme}
                                        onClick={() => handleThemeToggle(theme)}
                                        className={`btn ${selectedThemes.includes(theme) ? 'btn-success' : 'btn-secondary'}`}
                                        disabled={!selectedThemes.includes(theme) && selectedThemes.length >= 5}
                                        style={{
                                            padding: '15px',
                                            fontSize: '14px',
                                            opacity: (!selectedThemes.includes(theme) && selectedThemes.length >= 5) ? 0.5 : 1
                                        }}
                                    >
                                        {theme}
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>
                );
            }

            // UNICORN CANVAS: –§–∞–∑–∞ –º–∞–ª—é–≤–∞–Ω–Ω—è (—Ç–∞ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ —Ñ–∞–∑–∏ –∑ –∫–∞–Ω–≤–∞—Å–æ–º)
            if (gameState === 'unicorn_drawing' || gameState === 'voting_fake' || gameState === 'fake_guessing' || gameState === 'voting_answer') {
                const currentPlayerId = turnOrder[currentTurnIndex];
                const isMyTurn = currentPlayerId === playerId;
                const currentPlayer = roomData?.players?.find(p => p.id === currentPlayerId);

                const startDrawing = (e) => {
                    if (!isMyTurn || !canvasBoundsRef.current || !ctxRef.current) return;

                    const canvas = canvasRef.current;
                    const rect = canvasBoundsRef.current;
                    const x = (e.clientX - rect.left) * (canvas.width / rect.width);
                    const y = (e.clientY - rect.top) * (canvas.height / rect.height);

                    setIsDrawing(true);
                    lastXRef.current = x;
                    lastYRef.current = y;

                    const ctx = ctxRef.current;
                    // –í–ò–ü–†–ê–í–õ–ï–ù–û: –ú–∞–ª—é—î–º–æ –¶–í–ï–¢–û–ú –ò–ì–†–û–ö–ê –æ–¥—Ä–∞–∑—É!
                    const myColor = roomData?.players?.find(p => p.id === playerId)?.color || '#000000';

                    ctx.strokeStyle = myColor;
                    ctx.fillStyle = myColor;
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.arc(x, y, 1.5, 0, 2 * Math.PI);
                    ctx.fill();
                    ctx.beginPath();
                    ctx.moveTo(x, y);

                    // –í–ò–ü–†–ê–í–õ–ï–ù–û: –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –∫–æ–ª—ñ—Ä —Ç–∞ playerId —É —à—Ç—Ä–∏—Ö–∞—Ö!
                    const stroke = { type: 'start', x: x / canvas.width, y: y / canvas.height, color: myColor, playerId };
                    strokeBufferRef.current.push(stroke);
                };

                const draw = (e) => {
                    if (!isMyTurn || !isDrawing || !canvasBoundsRef.current || !ctxRef.current || lastXRef.current === null) return;

                    e.preventDefault();

                    const canvas = canvasRef.current;
                    const rect = canvasBoundsRef.current;
                    const x = (e.clientX - rect.left) * (canvas.width / rect.width);
                    const y = (e.clientY - rect.top) * (canvas.height / rect.height);

                    // –í–ò–ü–†–ê–í–õ–ï–ù–û: –ú–∞–ª—é—î–º–æ –ª–æ–∫–∞–ª—å–Ω–æ –û–î–†–ê–ó–£ –¶–í–ï–¢–û–ú –ò–ì–†–û–ö–ê!
                    const ctx = ctxRef.current;
                    const myColor = roomData?.players?.find(p => p.id === playerId)?.color || '#000000';

                    ctx.strokeStyle = myColor;
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.moveTo(lastXRef.current, lastYRef.current);
                    ctx.lineTo(x, y);
                    ctx.stroke();

                    lastXRef.current = x;
                    lastYRef.current = y;

                    // –í–ò–ü–†–ê–í–õ–ï–ù–û: –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –∫–æ–ª—ñ—Ä —Ç–∞ playerId —É —à—Ç—Ä–∏—Ö–∞—Ö!
                    const stroke = { type: 'draw', x: x / canvas.width, y: y / canvas.height, color: myColor, playerId };
                    strokeBufferRef.current.push(stroke);

                    // –û–Ω–æ–≤–ª—é—î–º–æ custom cursor
                    updateCustomCursor(e.clientX, e.clientY);
                };

                const stopDrawing = () => {
                    if (!isMyTurn || !isDrawing) return;

                    setIsDrawing(false);
                    lastXRef.current = null;
                    lastYRef.current = null;

                    const stroke = { type: 'end' };
                    strokeBufferRef.current.push(stroke);

                    // –í–ò–ü–†–ê–í–õ–ï–ù–û: requestAnimationFrame —Å–∞–º –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ª–∏—à–∫–∏
                    // –•—ñ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–æ
                    if (socket) {
                        socket.emit('stroke_finished');
                    }
                };

                return (
                    <div className="game-container" style={{ padding: '20px' }}>
                        <div style={{ display: 'flex', gap: '20px' }}>
                            {/* –õ—ñ–≤–∞ –ø–∞–Ω–µ–ª—å: –ö–∞—Ä—Ç–∫–∞ —Ç–∞ –ø–æ—Ä—è–¥–æ–∫ –≥—Ä–∞–≤—Ü—ñ–≤ */}
                            <div style={{ width: '250px' }}>
                                <div className="player-card" style={{
                                    padding: '20px',
                                    background: '#f0f0f0',
                                    borderRadius: '10px',
                                    marginBottom: '20px'
                                }}>
                                    <h3>–í–∞—à–∞ –∫–∞—Ä—Ç–∫–∞</h3>
                                    <div style={{ fontSize: '18px', marginTop: '10px' }}>
                                        <strong>–ö–∞—Ç–µ–≥–æ—Ä—ñ—è:</strong> {currentTheme}
                                    </div>
                                    <div style={{
                                        fontSize: (() => {
                                            const word = playerCard?.word || '';
                                            const length = word.length;
                                            const wordCount = word.split(' ').length;
                                            // –ê–¥–∞–ø—Ç–∏–≤–Ω–∏–π —Ä–æ–∑–º—ñ—Ä —à—Ä–∏—Ñ—Ç—É –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –¥–æ–≤–∂–∏–Ω–∏
                                            if (wordCount > 1 || length > 15) return '20px';
                                            if (length > 10) return '26px';
                                            return '32px';
                                        })(),
                                        fontWeight: 'bold',
                                        marginTop: '15px',
                                        padding: '20px',
                                        background: playerCard?.isFake ? '#ffcccc' : '#ccffcc',
                                        borderRadius: '5px',
                                        textAlign: 'center',
                                        lineHeight: '1.3'
                                    }}>
                                        {playerCard?.word}
                                    </div>
                                </div>

                                <div className="turn-order" style={{
                                    padding: '15px',
                                    background: '#f9f9f9',
                                    borderRadius: '10px'
                                }}>
                                    <h3>–ü–æ—Ä—è–¥–æ–∫ —Ö–æ–¥—ñ–≤ (–†–∞—É–Ω–¥ {currentDrawingRound}/2)</h3>
                                    {turnOrder.map((pid, index) => {
                                        const player = roomData?.players?.find(p => p.id === pid);
                                        const isCurrent = index === currentTurnIndex;
                                        const isDone = index < currentTurnIndex || (currentDrawingRound === 2 && index < currentTurnIndex);

                                        return (
                                            <div key={pid} style={{
                                                padding: '8px',
                                                marginTop: '5px',
                                                background: isCurrent ? '#4CAF50' : (isDone ? '#e0e0e0' : 'white'),
                                                borderRadius: '5px',
                                                display: 'flex',
                                                alignItems: 'center',
                                                gap: '10px'
                                            }}>
                                                <div style={{
                                                    width: '20px',
                                                    height: '20px',
                                                    borderRadius: '50%',
                                                    background: player?.color || '#ccc'
                                                }}></div>
                                                <span style={{
                                                    fontWeight: isCurrent ? 'bold' : 'normal',
                                                    color: isCurrent ? 'white' : (player?.color || '#000')
                                                }}>
                                                    {player?.name || '–ì—Ä–∞–≤–µ—Ü—å'}
                                                    {pid === playerId && ' (–í–∏)'}
                                                    {isCurrent && ' üé®'}
                                                    {isDone && ' ‚úì'}
                                                </span>
                                            </div>
                                        );
                                    })}
                                </div>

                                <div style={{ marginTop: '20px', textAlign: 'center' }}>
                                    <h3>
                                        {isMyTurn ? '–í–∞—à —Ö—ñ–¥!' : (
                                            <>
                                                –ú–∞–ª—é—î: <span style={{ color: currentPlayer?.color || '#000' }}>{currentPlayer?.name}</span>
                                            </>
                                        )}
                                    </h3>
                                    <div style={{ fontSize: '24px', color: drawingTimeLeft <= 10 ? '#ff0000' : '#666' }}>
                                        ‚è±Ô∏è {drawingTimeLeft} —Å–µ–∫.
                                    </div>
                                </div>

                                {/* –ö–Ω–æ–ø–∫–∞ "–ü—Ä–∞–≤–∏–ª–∞ –≥—Ä–∏" */}
                                <div style={{ marginTop: '20px', textAlign: 'center' }}>
                                    <button
                                        onClick={() => setShowRules(true)}
                                        className="btn btn-secondary"
                                        style={{ fontSize: '14px', padding: '10px 20px' }}
                                    >
                                        ‚ùì –ü—Ä–∞–≤–∏–ª–∞ –≥—Ä–∏
                                    </button>
                                </div>
                            </div>

                            {/* –¶–µ–Ω—Ç—Ä: –°–ø—ñ–ª—å–Ω–∏–π –∫–∞–Ω–≤–∞—Å */}
                            <div style={{ flex: 1, position: 'relative' }}>
                                <h2 style={{ textAlign: 'center', marginBottom: '10px' }}>
                                    –°–ø—ñ–ª—å–Ω–∏–π –º–∞–ª—é–Ω–æ–∫
                                </h2>
                                <canvas
                                    ref={canvasRef}
                                    width={800}
                                    height={600}
                                    onMouseDown={startDrawing}
                                    onMouseMove={(e) => {
                                        draw(e);
                                        updateCustomCursor(e.clientX, e.clientY);
                                    }}
                                    onMouseUp={stopDrawing}
                                    onMouseLeave={() => {
                                        stopDrawing();
                                        if (customCursorRef.current) {
                                            customCursorRef.current.style.display = 'none';
                                        }
                                    }}
                                    onMouseEnter={(e) => {
                                        if (isMyTurn && customCursorRef.current) {
                                            customCursorRef.current.style.display = 'block';
                                            updateCustomCursor(e.clientX, e.clientY);
                                        }
                                    }}
                                    style={{
                                        border: '2px solid #333',
                                        borderRadius: '10px',
                                        background: 'white',
                                        cursor: isMyTurn ? 'none' : 'not-allowed',
                                        display: 'block',
                                        margin: '0 auto',
                                        touchAction: 'none'
                                    }}
                                />
                                <div style={{ textAlign: 'center', marginTop: '10px', color: '#666' }}>
                                    {isMyTurn ? '–ù–∞–º–∞–ª—é–π—Ç–µ –æ–¥–Ω—É –ª—ñ–Ω—ñ—é (–≤—ñ–¥–ø—É—Å—Ç—ñ—Ç—å –º–∏—à—É —â–æ–± –∑–∞–≤–µ—Ä—à–∏—Ç–∏ —Ö—ñ–¥)' : '–ß–µ–∫–∞–π—Ç–µ —Å–≤–æ–≥–æ —Ö–æ–¥—É...'}
                                </div>

                                {/* –í–ò–ü–†–ê–í–õ–ï–ù–û: Custom cursor */}
                                {isMyTurn && (
                                    <div
                                        ref={customCursorRef}
                                        style={{
                                            position: 'fixed',
                                            width: '10px',
                                            height: '10px',
                                            borderRadius: '50%',
                                            backgroundColor: roomData?.players?.find(p => p.id === playerId)?.color || '#000000',
                                            pointerEvents: 'none',
                                            zIndex: 9999,
                                            transform: 'translate(-50%, -50%)',
                                            display: 'none',
                                            border: '2px solid white',
                                            boxShadow: '0 0 3px rgba(0,0,0,0.5)'
                                        }}
                                    />
                                )}
                            </div>

                            {/* –ü—Ä–∞–≤–∞ –ø–∞–Ω–µ–ª—å: –û—á–∫–∏ */}
                            <div style={{ width: '200px' }}>
                                <div style={{
                                    padding: '15px',
                                    background: '#f9f9f9',
                                    borderRadius: '10px'
                                }}>
                                    <h3>–†–∞—Ö—É–Ω–æ–∫</h3>
                                    {roomData?.players?.map(player => (
                                        <div key={player.id} style={{
                                            padding: '8px',
                                            marginTop: '5px',
                                            background: 'white',
                                            borderRadius: '5px'
                                        }}>
                                            <div style={{ fontWeight: 'bold', color: player.color || '#000' }}>
                                                {player.name}
                                                {player.id === playerId && ' (–í–∏)'}
                                            </div>
                                            <div style={{ fontSize: '20px', color: '#4CAF50' }}>
                                                {roomData?.scores?.[player.id] || 0} –æ—á–æ–∫
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>

                        {/* –ú–û–î–ê–õ–¨–ù–ï –í–Ü–ö–ù–û: –ü—Ä–∞–≤–∏–ª–∞ –≥—Ä–∏ */}
                        {showRules && (
                            <div style={{
                                position: 'fixed',
                                top: 0,
                                left: 0,
                                right: 0,
                                bottom: 0,
                                backgroundColor: 'rgba(0, 0, 0, 0.7)',
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                zIndex: 10000
                            }}>
                                <div style={{
                                    backgroundColor: 'white',
                                    padding: '30px',
                                    borderRadius: '15px',
                                    maxWidth: '700px',
                                    maxHeight: '80vh',
                                    overflow: 'auto',
                                    position: 'relative',
                                    boxShadow: '0 4px 20px rgba(0, 0, 0, 0.3)'
                                }}>
                                    <button
                                        onClick={() => setShowRules(false)}
                                        style={{
                                            position: 'absolute',
                                            top: '15px',
                                            right: '15px',
                                            background: 'none',
                                            border: 'none',
                                            fontSize: '28px',
                                            cursor: 'pointer',
                                            color: '#666'
                                        }}
                                    >
                                        √ó
                                    </button>

                                    <h2 style={{ marginBottom: '20px', color: '#333' }}>–ü—Ä–∞–≤–∏–ª–∞ –≥—Ä–∏ "–ü—ñ–¥—Ä–æ–±–Ω–∏–π —Ö—É–¥–æ–∂–Ω–∏–∫"</h2>

                                    <div style={{ lineHeight: '1.6', color: '#555' }}>
                                        <h3 style={{ marginTop: '15px', color: '#4CAF50' }}>–•—ñ–¥ –≥—Ä–∏:</h3>

                                        <p><strong>1. –í–∏–±—ñ—Ä —Ç–µ–º</strong></p>
                                        <p>–ö–æ–∂–µ–Ω –≥—Ä–∞–≤–µ—Ü—å –æ–±–∏—Ä–∞—î 5 —Ç–µ–º –∑ 12 –∑–∞–ø—Ä–æ–ø–æ–Ω–æ–≤–∞–Ω–∏—Ö. –ó –æ–±—Ä–∞–Ω–∏—Ö —Ç–µ–º —Ñ–æ—Ä–º—É—î—Ç—å—Å—è –ø—É–ª –∑–∞–≤–¥–∞–Ω—å –¥–ª—è —Ä–∞—É–Ω–¥—É.</p>

                                        <p style={{ marginTop: '15px' }}><strong>2. –†–æ–∑–¥–∞—á–∞ –∫–∞—Ä—Ç–æ–∫</strong></p>
                                        <p>–£—Å—ñ–º –≥—Ä–∞–≤—Ü—è–º –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è –∫–∞—Ç–µ–≥–æ—Ä—ñ—è. –°–ø—Ä–∞–≤–∂–Ω—ñ —Ö—É–¥–æ–∂–Ω–∏–∫–∏ –±–∞—á–∞—Ç—å –∑–∞–≥–∞–¥–∞–Ω–µ —Å–ª–æ–≤–æ. –û–¥–∏–Ω –ø—ñ–¥—Ä–æ–±–Ω–∏–π —Ö—É–¥–æ–∂–Ω–∏–∫ –±–∞—á–∏—Ç—å "–•" –∑–∞–º—ñ—Å—Ç—å —Å–ª–æ–≤–∞.</p>

                                        <p style={{ marginTop: '15px' }}><strong>3. –ú–∞–ª—é–≤–∞–Ω–Ω—è</strong></p>
                                        <p>–ì—Ä–∞–≤—Ü—ñ –ø–æ —á–µ—Ä–∑—ñ –º–∞–ª—é—é—Ç—å –û–î–ù–£ –ª—ñ–Ω—ñ—é –Ω–∞ —Å–ø—ñ–ª—å–Ω–æ–º—É –ø–æ–ª–æ—Ç–Ω—ñ. –í—ñ–¥–ø—É—Å—Ç–∏–≤ –º–∏—à–∫—É - –≤–∞—à–µ –º–∞–ª—é–≤–∞–Ω–Ω—è –∑–∞–∫—ñ–Ω—á–∏–ª–æ—Å—å.</p>
                                        <p>–ö–æ–∂–µ–Ω —Ä–æ–±–∏—Ç—å 2 —Ö–æ–¥–∏. –ü—ñ–¥—Ä–æ–±–Ω–∏–π —Ö—É–¥–æ–∂–Ω–∏–∫ –ø–æ–≤–∏–Ω–µ–Ω –º–∞–ª—é–≤–∞—Ç–∏ —Ç–∞–∫, —â–æ–± –Ω–µ –≤–∏–¥–∞—Ç–∏ —Å–µ–±–µ.</p>

                                        <p style={{ marginTop: '15px' }}><strong>4. –ì–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è</strong></p>
                                        <p>–ü—ñ—Å–ª—è –º–∞–ª—é–≤–∞–Ω–Ω—è –≤—Å—ñ –≥—Ä–∞–≤—Ü—ñ, –≤ —Ç–æ–º—É —á–∏—Å–ª—ñ —ñ –ø—ñ–¥—Ä–æ–±–Ω–∏–π —Ö—É–¥–æ–∂–Ω–∏–∫, –≥–æ–ª–æ—Å—É—é—Ç—å –∑–∞ –ø—ñ–¥–æ–∑—Ä—ñ–ª–æ–≥–æ –≥—Ä–∞–≤—Ü—è.</p>
                                        <p>–Ø–∫—â–æ –±—ñ–ª—å—à—ñ—Å—Ç—å –≥–æ–ª–æ—Å—ñ–≤ –Ω–∞–±–∏—Ä–∞—î –ø—ñ–¥—Ä–æ–±–Ω–∏–π —Ö—É–¥–æ–∂–Ω–∏–∫ - –≤—ñ–Ω —Ä–æ–∑–∫—Ä–∏–≤–∞—î—Ç—å—Å—è.</p>
                                        <p>–Ø–∫—â–æ –±—ñ–ª—å—à—ñ—Å—Ç—å –≥–æ–ª–æ—Å—ñ–≤ –≤–∫–∞–∑—É—é—Ç—å –Ω–∞ —Å–ø—Ä–∞–≤–∂–Ω—å–æ–≥–æ —Ö—É–¥–æ–∂–Ω–∏–∫–∞ - –ø—ñ–¥—Ä–æ–±–Ω–∏–π –Ω–∞–±–∏—Ä–∞—î –æ—á–∫–∏, –±–æ –π–æ–≥–æ –Ω–µ –≤–∏–∫—Ä–∏–ª–∏.</p>

                                        <p style={{ marginTop: '15px' }}><strong>5. –í—ñ–¥–≥–∞–¥—É–≤–∞–Ω–Ω—è</strong></p>
                                        <p>–Ø–∫—â–æ –ø—ñ–¥—Ä–æ–±–Ω–æ–≥–æ –∑–Ω–∞–π–¥–µ–Ω–æ - –≤—ñ–Ω –º–æ–∂–µ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –≤–≥–∞–¥–∞—Ç–∏ —Å–ª–æ–≤–æ. –Ø–∫—â–æ –≤–≥–∞–¥–∞—î - –æ—Ç—Ä–∏–º—É—î –æ—á–∫–∏.</p>

                                        <h3 style={{ marginTop: '20px', color: '#4CAF50' }}>–ù–∞—Ä–∞—Ö—É–≤–∞–Ω–Ω—è –æ—á–æ–∫:</h3>
                                        <ul style={{ marginLeft: '20px' }}>
                                            <li>–ü—ñ–¥—Ä–æ–±–Ω–∏–π –ù–ï –∑–Ω–∞–π–¥–µ–Ω–∏–π ‚Üí –ü—ñ–¥—Ä–æ–±–Ω–∏–π: <strong>+2 –æ—á–∫–∞</strong></li>
                                            <li>–ü—ñ–¥—Ä–æ–±–Ω–∏–π –∑–Ω–∞–π–¥–µ–Ω–∏–π, –∞–ª–µ –≤–≥–∞–¥–∞–≤ —Å–ª–æ–≤–æ ‚Üí –ü—ñ–¥—Ä–æ–±–Ω–∏–π: <strong>+2 –æ—á–∫–∞</strong></li>
                                            <li>–ü—ñ–¥—Ä–æ–±–Ω–∏–π –∑–Ω–∞–π–¥–µ–Ω–∏–π —ñ –ù–ï –≤–≥–∞–¥–∞–≤ ‚Üí –•—É–¥–æ–∂–Ω–∏–∫–∏: <strong>+1 –æ—á–∫–æ –∫–æ–∂–µ–Ω</strong></li>
                                        </ul>

                                        <div style={{
                                            marginTop: '20px',
                                            padding: '15px',
                                            backgroundColor: '#e8f5e9',
                                            borderRadius: '8px',
                                            borderLeft: '4px solid #4CAF50'
                                        }}>
                                            <strong>üí° –ü–æ—Ä–∞–¥–∞:</strong> –ü—ñ–¥—Ä–æ–±–Ω–∏–π —Ö—É–¥–æ–∂–Ω–∏–∫ –ø–æ–≤–∏–Ω–µ–Ω —É–≤–∞–∂–Ω–æ —Å–ø–æ—Å—Ç–µ—Ä—ñ–≥–∞—Ç–∏ –∑–∞ –º–∞–ª—é–Ω–∫–∞–º–∏ —ñ–Ω—à–∏—Ö —ñ –º–∞–ª—é–≤–∞—Ç–∏ —â–æ—Å—å —Å—Ö–æ–∂–µ.
                                        </div>
                                    </div>

                                    <div style={{ marginTop: '25px', textAlign: 'center' }}>
                                        <button
                                            onClick={() => setShowRules(false)}
                                            className="btn btn-primary"
                                            style={{ padding: '10px 30px', fontSize: '16px' }}
                                        >
                                            –ó—Ä–æ–∑—É–º—ñ–ª–æ
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* –ú–û–î–ê–õ–¨–ù–ê –°–ï–ö–¶–Ü–Ø: –ì–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è –∑–∞ –ø—ñ–¥—Ä–æ–±–Ω–æ–≥–æ —Ö—É–¥–æ–∂–Ω–∏–∫–∞ */}
                        {gameState === 'voting_fake' && (
                            <div className="modal-section" style={{ maxWidth: '800px', margin: '20px auto' }}>
                                <h2 style={{ fontSize: '22px', marginBottom: '10px', textAlign: 'center' }}>
                                    –•—Ç–æ –ø—ñ–¥—Ä–æ–±–Ω–∏–π —Ö—É–¥–æ–∂–Ω–∏–∫? üé≠
                                </h2>
                                <p style={{ fontSize: '14px', marginBottom: '15px', textAlign: 'center', color: '#666' }}>
                                    –ü—Ä–æ–≥–æ–ª–æ—Å—É–π—Ç–µ –∑–∞ –≥—Ä–∞–≤—Ü—è, —è–∫–æ–≥–æ –≤–∏ –ø—ñ–¥–æ–∑—Ä—é—î—Ç–µ
                                </p>
                                <p style={{ fontSize: '16px', color: votingTimeLeft <= 5 ? '#ff0000' : '#666', textAlign: 'center', marginBottom: '15px' }}>
                                    ‚è±Ô∏è {votingTimeLeft} —Å–µ–∫.
                                </p>

                                <div style={{
                                    display: 'grid',
                                    gridTemplateColumns: 'repeat(auto-fit, minmax(150px, 1fr))',
                                    gap: '10px',
                                    marginBottom: '10px'
                                }}>
                                    {roomData?.players?.map(player => (
                                        <button
                                            key={player.id}
                                            onClick={() => {
                                                setMyVoteForFake(player.id);
                                                if (socket) {
                                                    socket.emit('vote_fake_artist', { suspectId: player.id });
                                                }
                                            }}
                                            className={`btn ${myVoteForFake === player.id ? 'btn-danger' : 'btn-secondary'}`}
                                            disabled={myVoteForFake !== null}
                                            style={{
                                                padding: '10px',
                                                fontSize: '14px',
                                                display: 'flex',
                                                alignItems: 'center',
                                                gap: '8px',
                                                justifyContent: 'center'
                                            }}
                                        >
                                            <div style={{
                                                width: '20px',
                                                height: '20px',
                                                borderRadius: '50%',
                                                background: player.color || '#ccc'
                                            }}></div>
                                            <span style={{ fontSize: '13px', color: player.color || '#000', fontWeight: 'bold' }}>
                                                {player.name}
                                                {player.id === playerId && ' (–í–∏)'}
                                            </span>
                                        </button>
                                    ))}
                                </div>

                                {myVoteForFake && (
                                    <div style={{ textAlign: 'center', marginTop: '10px', color: '#4CAF50', fontSize: '14px' }}>
                                        ‚úì –í–∞—à –≥–æ–ª–æ—Å –∑–±–µ—Ä–µ–∂–µ–Ω–æ. –û—á—ñ–∫—É–≤–∞–Ω–Ω—è —ñ–Ω—à–∏—Ö –≥—Ä–∞–≤—Ü—ñ–≤...
                                    </div>
                                )}
                            </div>
                        )}

                        {/* –ú–û–î–ê–õ–¨–ù–ê –°–ï–ö–¶–Ü–Ø: –ü—ñ–¥—Ä–æ–±–Ω–∏–π —Ö—É–¥–æ–∂–Ω–∏–∫ –≤–≥–∞–¥—É—î —Å–ª–æ–≤–æ */}
                        {gameState === 'fake_guessing' && (() => {
                            const isFakeArtist = playerCard?.isFake;

                            return (
                                <div className="modal-section" style={{ maxWidth: '600px', margin: '20px auto' }}>
                                    {isFakeArtist ? (
                                        <>
                                            <h2 style={{ fontSize: '22px', marginBottom: '10px', textAlign: 'center' }}>
                                                –í–∞—Å —Å–ø—ñ–π–º–∞–ª–∏! üé≠
                                            </h2>
                                            <p style={{ fontSize: '14px', marginBottom: '10px', textAlign: 'center' }}>
                                                –°–ø—Ä–æ–±—É–π—Ç–µ –≤–≥–∞–¥–∞—Ç–∏ –∑–∞–≥–∞–¥–∞–Ω–µ —Å–ª–æ–≤–æ –∑ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó: <strong>{currentTheme}</strong>
                                            </p>
                                            <p style={{ fontSize: '16px', color: guessingTimeLeft <= 10 ? '#ff0000' : '#666', marginBottom: '15px', textAlign: 'center' }}>
                                                ‚è±Ô∏è {guessingTimeLeft} —Å–µ–∫.
                                            </p>

                                            <div style={{ textAlign: 'center' }}>
                                                <input
                                                    type="text"
                                                    value={fakeGuessInput}
                                                    onChange={(e) => setFakeGuessInput(e.target.value)}
                                                    placeholder="–í–≤–µ–¥—ñ—Ç—å –≤–∞—à–µ –ø—Ä–∏–ø—É—â–µ–Ω–Ω—è..."
                                                    style={{
                                                        padding: '10px',
                                                        fontSize: '16px',
                                                        width: '300px',
                                                        maxWidth: '90%',
                                                        borderRadius: '5px',
                                                        border: '2px solid #ccc',
                                                        marginBottom: '10px'
                                                    }}
                                                    onKeyPress={(e) => {
                                                        if (e.key === 'Enter' && fakeGuessInput.trim()) {
                                                            if (socket) {
                                                                socket.emit('submit_fake_guess', { guess: fakeGuessInput.trim() });
                                                            }
                                                        }
                                                    }}
                                                />

                                                <div>
                                                    <button
                                                        onClick={() => {
                                                            if (socket && fakeGuessInput.trim()) {
                                                                socket.emit('submit_fake_guess', { guess: fakeGuessInput.trim() });
                                                            }
                                                        }}
                                                        className="btn btn-primary"
                                                        disabled={!fakeGuessInput.trim()}
                                                        style={{ fontSize: '16px', padding: '10px 30px' }}
                                                    >
                                                        –ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å
                                                    </button>
                                                </div>
                                            </div>
                                        </>
                                    ) : (
                                        <>
                                            <h2 style={{ fontSize: '22px', marginBottom: '10px', textAlign: 'center' }}>
                                                –ü—ñ–¥—Ä–æ–±–Ω–æ–≥–æ —Ö—É–¥–æ–∂–Ω–∏–∫–∞ —Å–ø—ñ–π–º–∞–Ω–æ! üé≠
                                            </h2>
                                            <p style={{ fontSize: '16px', textAlign: 'center' }}>
                                                –ó–∞—Ä–∞–∑ –≤—ñ–Ω –Ω–∞–º–∞–≥–∞—î—Ç—å—Å—è –≤–≥–∞–¥–∞—Ç–∏ —Å–ª–æ–≤–æ...
                                            </p>
                                            <div style={{ fontSize: '32px', margin: '20px 0', textAlign: 'center' }}>‚è≥</div>
                                        </>
                                    )}
                                </div>
                            );
                        })()}

                        {/* –ú–û–î–ê–õ–¨–ù–ê –°–ï–ö–¶–Ü–Ø: –ì–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è –∑–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ—Å—Ç—å –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ */}
                        {gameState === 'voting_answer' && (() => {
                            const isFakeArtist = playerCard?.isFake;

                            return (
                                <div className="modal-section" style={{ maxWidth: '700px', margin: '20px auto' }}>
                                    <h2 style={{ fontSize: '22px', marginBottom: '10px', textAlign: 'center' }}>
                                        –ß–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å? ü§î
                                    </h2>

                                    <div style={{
                                        fontSize: '16px',
                                        marginTop: '15px',
                                        padding: '12px',
                                        background: '#f9f9f9',
                                        borderRadius: '8px',
                                        marginBottom: '15px'
                                    }}>
                                        <div style={{ marginBottom: '8px' }}>
                                            <strong>–ö–∞—Ç–µ–≥–æ—Ä—ñ—è:</strong> {currentTheme}
                                        </div>
                                        <div style={{ marginBottom: '8px' }}>
                                            <strong>–ü—Ä–∞–≤–∏–ª—å–Ω–µ —Å–ª–æ–≤–æ:</strong> <span style={{ fontSize: '20px', color: '#4CAF50', fontWeight: 'bold' }}>{roomData?.currentWord || '...'}</span>
                                        </div>
                                        <div>
                                            <strong>–í—ñ–¥–ø–æ–≤—ñ–¥—å –ø—ñ–¥—Ä–æ–±–Ω–æ–≥–æ:</strong> <span style={{ fontSize: '20px', color: '#FF5722', fontWeight: 'bold' }}>{fakeArtistGuess}</span>
                                        </div>
                                    </div>

                                    {!isFakeArtist ? (
                                        <>
                                            <p style={{ fontSize: '14px', marginBottom: '15px', textAlign: 'center' }}>
                                                –ü—Ä–æ–≥–æ–ª–æ—Å—É–π—Ç–µ: —á–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤–≥–∞–¥–∞–≤ –ø—ñ–¥—Ä–æ–±–Ω–∏–π —Ö—É–¥–æ–∂–Ω–∏–∫?
                                            </p>

                                            <div style={{ display: 'flex', gap: '15px', justifyContent: 'center' }}>
                                                <button
                                                    onClick={() => {
                                                        setMyVoteForAnswer(true);
                                                        if (socket) {
                                                            socket.emit('vote_answer_correctness', { isCorrect: true });
                                                        }
                                                    }}
                                                    className={`btn ${myVoteForAnswer === true ? 'btn-success' : 'btn-secondary'}`}
                                                    disabled={myVoteForAnswer !== null}
                                                    style={{ padding: '12px 30px', fontSize: '16px' }}
                                                >
                                                    ‚úì –ü—Ä–∞–≤–∏–ª—å–Ω–æ
                                                </button>
                                                <button
                                                    onClick={() => {
                                                        setMyVoteForAnswer(false);
                                                        if (socket) {
                                                            socket.emit('vote_answer_correctness', { isCorrect: false });
                                                        }
                                                    }}
                                                    className={`btn ${myVoteForAnswer === false ? 'btn-danger' : 'btn-secondary'}`}
                                                    disabled={myVoteForAnswer !== null}
                                                    style={{ padding: '12px 30px', fontSize: '16px' }}
                                                >
                                                    ‚úó –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
                                                </button>
                                            </div>

                                            {myVoteForAnswer !== null && (
                                                <div style={{ textAlign: 'center', marginTop: '12px', color: '#4CAF50', fontSize: '14px' }}>
                                                    ‚úì –í–∞—à –≥–æ–ª–æ—Å –∑–±–µ—Ä–µ–∂–µ–Ω–æ
                                                </div>
                                            )}
                                        </>
                                    ) : (
                                        <div style={{ fontSize: '16px', color: '#666', textAlign: 'center' }}>
                                            –Ü–Ω—à—ñ –≥—Ä–∞–≤—Ü—ñ –≥–æ–ª–æ—Å—É—é—Ç—å...
                                        </div>
                                    )}
                                </div>
                            );
                        })()}
                    </div>
                );
            }

            if (gameState === 'playing') {
                return (
                    <GameBoard
                        socket={socket}
                        playerId={playerId}
                        roundData={roundData}
                        drawings={drawings}
                        setDrawings={setDrawings}
                        myGuesses={myGuesses}
                        usedNumbers={usedNumbers}
                        myGuessResults={myGuessResults}
                        showCorrectAnswers={showCorrectAnswers}
                        allCorrectAssignments={allCorrectAssignments}
                        isDrawingLocked={isDrawingLocked}
                        makeGuess={makeGuess}
                        isHost={isHost}
                        endRound={endRound}
                        guessProgress={guessProgress}
                    />
                );
            }

            // UNICORN CANVAS: –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Ä–∞—É–Ω–¥—É
            if (gameState === 'unicorn_round_end') {
                const results = unicornRoundResults || {};
                const isGameEnd = roomData?.state === 'game_end';

                return (
                    <div className="results-modal">
                        <div className="results-content">
                            <div className="results-header">
                                <h2>{isGameEnd ? '–ì—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!' : `–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Ä–∞—É–Ω–¥—É ${roomData?.currentRound}`}</h2>
                            </div>

                            {/* –í–ò–ü–†–ê–í–õ–ï–ù–û: –ö–æ–º–ø–∞–∫—Ç–Ω—ñ—à—ñ –≤—ñ–¥—Å—Ç—É–ø–∏ */}
                            <div style={{ marginTop: '15px' }}>
                                <h3 style={{ marginBottom: '8px' }}>–†–æ–∑–∫—Ä–∏—Ç—Ç—è —Ä–æ–ª–µ–π:</h3>
                                <div style={{
                                    padding: '12px',
                                    background: '#fff3cd',
                                    borderRadius: '8px',
                                    marginTop: '8px'
                                }}>
                                    <div style={{ fontSize: '16px', marginBottom: '6px' }}>
                                        <strong>–ö–∞—Ç–µ–≥–æ—Ä—ñ—è:</strong> {results.theme}
                                    </div>
                                    <div style={{ fontSize: '16px', marginBottom: '6px' }}>
                                        <strong>–ó–∞–≥–∞–¥–∞–Ω–µ —Å–ª–æ–≤–æ:</strong> {results.word}
                                    </div>
                                    <div style={{ fontSize: '16px', color: '#FF5722' }}>
                                        <strong>–ü—ñ–¥—Ä–æ–±–Ω–∏–π —Ö—É–¥–æ–∂–Ω–∏–∫:</strong> {roomData?.players?.find(p => p.id === results.fakeArtistId)?.name}
                                    </div>
                                </div>
                            </div>

                            <div style={{ marginTop: '15px' }}>
                                <h3 style={{ marginBottom: '8px' }}>–©–æ —Å—Ç–∞–ª–æ—Å—è:</h3>
                                <div style={{
                                    padding: '10px',
                                    background: results.fakeWins ? '#ffebee' : '#e8f5e9',
                                    borderRadius: '8px',
                                    fontSize: '16px',
                                    marginTop: '8px'
                                }}>
                                    {!results.fakeIsCaught && (
                                        <p style={{ margin: 0 }}>üé≠ –ü—ñ–¥—Ä–æ–±–Ω–æ–≥–æ —Ö—É–¥–æ–∂–Ω–∏–∫–∞ –Ω–µ –≤–ø—ñ–π–º–∞–ª–∏! –í—ñ–Ω –≤–∏–≥—Ä–∞–≤!</p>
                                    )}
                                    {results.fakeIsCaught && results.guessCorrect && (
                                        <p style={{ margin: 0 }}>üé≠ –ü—ñ–¥—Ä–æ–±–Ω–æ–≥–æ –≤–ø—ñ–π–º–∞–ª–∏, –∞–ª–µ –≤—ñ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤–≥–∞–¥–∞–≤ —Å–ª–æ–≤–æ! –í—ñ–Ω –≤–∏–≥—Ä–∞–≤!</p>
                                    )}
                                    {results.fakeIsCaught && !results.guessCorrect && (
                                        <p style={{ margin: 0 }}>‚úÖ –ü—ñ–¥—Ä–æ–±–Ω–æ–≥–æ –≤–ø—ñ–π–º–∞–ª–∏ —ñ –≤—ñ–Ω –Ω–µ –≤–≥–∞–¥–∞–≤ —Å–ª–æ–≤–æ! –•—É–¥–æ–∂–Ω–∏–∫–∏ –ø–µ—Ä–µ–º–æ–≥–ª–∏!</p>
                                    )}
                                </div>
                            </div>

                            <div className="scores-table" style={{ marginTop: '15px' }}>
                                <h3 style={{ marginBottom: '8px' }}>–†–∞—Ö—É–Ω–æ–∫:</h3>
                                <table style={{ width: '100%', marginTop: '8px' }}>
                                    <thead>
                                        <tr>
                                            <th>–ì—Ä–∞–≤–µ—Ü—å</th>
                                            <th>–û—á–∫–∏</th>
                                            <th>–†–æ–ª—å</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {Object.entries(results.scores || {})
                                            .sort(([,a], [,b]) => b - a)
                                            .map(([pid, score]) => {
                                                const player = roomData?.players?.find(p => p.id === pid);
                                                const isFake = pid === results.fakeArtistId;
                                                return (
                                                    <tr key={pid}>
                                                        <td>
                                                            {player?.name}
                                                            {pid === playerId && ' (–í–∏)'}
                                                        </td>
                                                        <td style={{ fontSize: '20px', fontWeight: 'bold', color: '#4CAF50' }}>
                                                            {score}
                                                        </td>
                                                        <td>
                                                            {isFake ? 'üé≠ –ü—ñ–¥—Ä–æ–±–Ω–∏–π' : 'üé® –•—É–¥–æ–∂–Ω–∏–∫'}
                                                        </td>
                                                    </tr>
                                                );
                                            })}
                                    </tbody>
                                </table>
                            </div>

                            {/* –í–ò–ü–†–ê–í–õ–ï–ù–û: –ö–æ–º–ø–∞–∫—Ç–Ω—ñ—à—ñ –≤—ñ–¥—Å—Ç—É–ø–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ */}
                            <div className="results-actions" style={{ marginTop: '15px' }}>
                                {isGameEnd ? (
                                    <div>
                                        <h2 style={{ color: '#4CAF50', marginBottom: '12px', fontSize: '1.3em' }}>
                                            üèÜ –ü–µ—Ä–µ–º–æ–∂–µ—Ü—å: {roomData?.players?.find(p => p.id === roomData?.winner)?.name}!
                                        </h2>
                                        {isHost && (
                                            <button onClick={() => socket?.emit('new_game')} className="btn btn-primary">
                                                –ù–æ–≤–∞ –≥—Ä–∞
                                            </button>
                                        )}
                                    </div>
                                ) : (
                                    <>
                                        {isHost && (
                                            <button
                                                onClick={() => socket?.emit('start_next_round')}
                                                className="btn btn-primary"
                                            >
                                                –ù–∞—Å—Ç—É–ø–Ω–∏–π —Ä–∞—É–Ω–¥
                                            </button>
                                        )}
                                        {!isHost && <p style={{ margin: '10px 0' }}>–û—á—ñ–∫—É–≤–∞–Ω–Ω—è –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ —Ä–∞—É–Ω–¥—É...</p>}
                                    </>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            if (gameState === 'round_end') {
                return (
                    <div className="results-modal">
                        <div className="results-content">
                            <div className="results-header">
                                <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Ä–∞—É–Ω–¥—É {roundData?.round}</h2>
                            </div>
                            
                            <div className="scores-table">
                                <table style={{ width: '100%' }}>
                                    <thead>
                                        <tr>
                                            <th>–ì—Ä–∞–≤–µ—Ü—å</th>
                                            <th>–û—á–∫–∏ –∑–∞ —Ä–∞—É–Ω–¥</th>
                                            <th>–ó–∞–≥–∞–ª—å–Ω—ñ –æ—á–∫–∏</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {Object.entries(roundResults?.totalScores || {})
                                            .sort(([,a], [,b]) => b - a)
                                            .map(([pid, score]) => {
                                                const player = roundData?.players?.find(p => p.id === pid);
                                                const details = roundResults?.scoreDetails?.[pid];

                                                // DEBUG: –õ–æ–≥—É—î–º–æ –¥–∞–Ω—ñ –¥–ª—è –≤—ñ–¥–ª–∞–¥–∫–∏
                                                if (details) {
                                                    console.log(`Player ${player?.name}:`, {
                                                        guessing: details.guessing,
                                                        penalty: details.penalty,
                                                        total: details.total
                                                    });
                                                }

                                                // –§–æ—Ä–º—É—î–º–æ —Ñ–æ—Ä–º—É–ª—É: 5+6+4-3=12
                                                let formula = '';
                                                if (details) {
                                                    const parts = [];

                                                    // –î–æ–¥–∞—î–º–æ –æ—á–∫–∏ –∑–∞ –≤—ñ–¥–≥–∞–¥—É–≤–∞–Ω–Ω—è
                                                    if (Array.isArray(details.guessing)) {
                                                        parts.push(...details.guessing.map(p => Number(p)));
                                                    }

                                                    // –î–æ–¥–∞—î–º–æ —à—Ç—Ä–∞—Ñ —è–∫—â–æ —î
                                                    if (details.penalty !== 0) {
                                                        parts.push(Number(details.penalty));
                                                    }

                                                    // –§–æ—Ä–º—É—î–º–æ —Å—Ç—Ä–æ–∫—É: –æ–±—Ä–æ–±–ª—è—î–º–æ –∫–æ–∂–Ω–µ —á–∏—Å–ª–æ –æ–∫—Ä–µ–º–æ
                                                    if (parts.length > 0) {
                                                        formula = parts.map((num, idx) => {
                                                            if (idx === 0) return String(num);
                                                            return num >= 0 ? `+${num}` : String(num);
                                                        }).join('') + `=${details.total}`;
                                                    } else {
                                                        formula = `${details.total}`;
                                                    }
                                                } else {
                                                    formula = (roundResults?.roundScores[pid] || 0).toString();
                                                }

                                                return (
                                                    <tr key={pid}>
                                                        <td>
                                                            {player?.name}
                                                            {pid === playerId && ' (–í–∏)'}
                                                        </td>
                                                        <td className="score-change">
                                                            {formula}
                                                        </td>
                                                        <td style={{ fontWeight: 'bold' }}>
                                                            {score}
                                                        </td>
                                                    </tr>
                                                );
                                            })}
                                    </tbody>
                                </table>
                            </div>
                            
                            {isHost && roundData?.round < 4 && (
                                <button className="btn btn-primary" onClick={nextRound}>
                                    –ù–∞—Å—Ç—É–ø–Ω–∏–π —Ä–∞—É–Ω–¥
                                </button>
                            )}
                        </div>
                    </div>
                );
            }
            
            if (gameState === 'game_end') {
                const sortedScores = Object.entries(finalResults?.finalScores || {})
                    .sort(([,a], [,b]) => b - a);
                const winner = roundData?.players?.find(p => p.id === sortedScores[0]?.[0]);
                
                return (
                    <div className="results-modal">
                        <div className="results-content">
                            <div className="winner-announcement">
                                <h3>üèÜ –ü–µ—Ä–µ–º–æ–∂–µ—Ü—å!</h3>
                                <div className="winner-name">{winner?.name}</div>
                                <div className="final-score">{sortedScores[0]?.[1]} –æ—á–æ–∫</div>
                            </div>
                            
                            <div className="scores-table">
                                <table style={{ width: '100%' }}>
                                    <thead>
                                        <tr>
                                            <th>–ú—ñ—Å—Ü–µ</th>
                                            <th>–ì—Ä–∞–≤–µ—Ü—å</th>
                                            <th>–û—á–∫–∏</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {sortedScores.map(([pid, score], index) => {
                                            const player = roundData?.players?.find(p => p.id === pid);
                                            return (
                                                <tr key={pid}>
                                                    <td style={{ fontSize: '1.5em' }}>
                                                        {index === 0 && 'ü•á'}
                                                        {index === 1 && 'ü•à'}
                                                        {index === 2 && 'ü•â'}
                                                        {index > 2 && (index + 1)}
                                                    </td>
                                                    <td>
                                                        {player?.name}
                                                        {pid === playerId && ' (–í–∏)'}
                                                    </td>
                                                    <td style={{ fontWeight: 'bold', fontSize: '1.2em' }}>
                                                        {score}
                                                    </td>
                                                </tr>
                                            );
                                        })}
                                    </tbody>
                                </table>
                            </div>
                            
                            {isHost && (
                                <button className="btn btn-primary" onClick={newGame}>
                                    –ù–æ–≤–∞ –≥—Ä–∞
                                </button>
                            )}
                        </div>
                    </div>
                );
            }
            
            return <div className="loading"><div className="loading-spinner"></div></div>;
        }
        
        // –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞ –∑ –ø—Ä–∞–≤–∏–ª–∞–º–∏
        function ScoreRulesModal({ onClose }) {
            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                        <div className="modal-header">
                            <h2>–ü—ñ–¥–∫–∞–∑–∫–∏ –ø–æ –≥—Ä—ñ</h2>
                            <button className="modal-close" onClick={onClose}>‚úï</button>
                        </div>

                        <div className="score-info">
                            <h3>–û—á–∫–∏ –∑–∞ –≤—ñ–¥–≥–∞–¥—É–≤–∞–Ω–Ω—è</h3>
                            <p>
                                –ß–∏–º —à–≤–∏–¥—à–µ –∑–∞ —ñ–Ω—à–∏—Ö –≥—Ä–∞–≤—Ü—ñ–≤ –≤–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤—ñ–¥–≥–∞–¥–∞—î—Ç–µ –º–∞–ª—é–Ω–æ–∫ —ñ–Ω—à–æ–≥–æ –≥—Ä–∞–≤—Ü—è,
                                —Ç–∏–º –±—ñ–ª—å—à–µ –æ—á–æ–∫ –≤—ñ–¥ –Ω—å–æ–≥–æ –æ—Ç—Ä–∏–º–∞—î—Ç–µ. –ß–µ—Ä–≥–∞ –æ—á–æ–∫: 6‚Üí5‚Üí5‚Üí4‚Üí4‚Üí3‚Üí3‚Üí2‚Üí2‚Üí1‚Üí1
                            </p>
                            <p>
                                –Ø–∫—â–æ –≤–∏ –ø–µ—Ä—à–∏–π –≤—ñ–¥–≥–∞–¥–∞–ª–∏ –º–∞–ª—é–Ω–æ–∫ - –æ—Ç—Ä–∏–º—É—î—Ç–µ 6 –æ—á–æ–∫, –¥—Ä—É–≥–∏–π - 5 –æ—á–æ–∫, —ñ —Ç–∞–∫ –¥–∞–ª—ñ.
                            </p>
                        </div>

                        <div className="score-info">
                            <h3>‚ö†Ô∏è –®—Ç—Ä–∞—Ñ–∏ –∑–∞ –ø–æ–≥–∞–Ω—ñ –º–∞–ª—é–Ω–∫–∏</h3>
                            <p>
                                –Ø–∫—â–æ —ñ–Ω—à—ñ –≥—Ä–∞–≤—Ü—ñ –ù–ï –≤—ñ–¥–≥–∞–¥–∞–ª–∏ –≤–∞—à –º–∞–ª—é–Ω–æ–∫, –≤–∏ –æ—Ç—Ä–∏–º—É—î—Ç–µ –º—ñ–Ω—É—Å–æ–≤—ñ –æ—á–∫–∏!
                                –®—Ç—Ä–∞—Ñ = —Å—É–º–∞ –Ω–µ—Ä–æ–∑–ø–æ–¥—ñ–ª–µ–Ω–∏—Ö –æ—á–æ–∫ –∑ –≤–∞—à–æ–≥–æ –ø—É–ª—É.
                            </p>
                            <p>
                                <strong>–ü—Ä–∏–∫–ª–∞–¥:</strong> –£ –≥—Ä—ñ 5 –≥—Ä–∞–≤—Ü—ñ–≤, –ø—É–ª –æ—á–æ–∫ –∫–æ–∂–Ω–æ–≥–æ: [6, 5, 5, 4].<br/>
                                ‚Ä¢ –Ø–∫—â–æ 3 –≥—Ä–∞–≤—Ü—ñ –≤—ñ–¥–≥–∞–¥–∞–ª–∏ –≤–∞—à –º–∞–ª—é–Ω–æ–∫ ‚Üí —Ä–æ–∑–ø–æ–¥—ñ–ª–µ–Ω–æ [6, 5, 5] ‚Üí —à—Ç—Ä–∞—Ñ <strong>-4 –æ—á–∫–∞</strong><br/>
                                ‚Ä¢ –Ø–∫—â–æ 2 –≥—Ä–∞–≤—Ü—ñ –≤—ñ–¥–≥–∞–¥–∞–ª–∏ ‚Üí —Ä–æ–∑–ø–æ–¥—ñ–ª–µ–Ω–æ [6, 5] ‚Üí —à—Ç—Ä–∞—Ñ <strong>-9 –æ—á–æ–∫</strong><br/>
                                ‚Ä¢ –Ø–∫—â–æ –Ω—ñ—Ö—Ç–æ –Ω–µ –≤—ñ–¥–≥–∞–¥–∞–≤ ‚Üí —à—Ç—Ä–∞—Ñ <strong>-20 –æ—á–æ–∫</strong>
                            </p>
                            <p style={{ color: '#f44336', fontWeight: 'bold' }}>
                                üí° –ú–∞–ª—é–π—Ç–µ –∑—Ä–æ–∑—É–º—ñ–ª–æ, —â–æ–± —ñ–Ω—à—ñ –∑–º–æ–≥–ª–∏ –≤—ñ–¥–≥–∞–¥–∞—Ç–∏!
                            </p>
                        </div>

                        <div className="score-info">
                            <h3>–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ä–∞—É–Ω–¥—É</h3>
                            <p>
                                –¢—ñ–ª—å–∫–∏ —Ö–æ—Å—Ç (–≥—Ä–∞–≤–µ—Ü—å –∑ –∫–æ—Ä–æ–Ω–æ—é üëë) –º–æ–∂–µ –∑–∞–≤–µ—Ä—à–∏—Ç–∏ —Ä–∞—É–Ω–¥.
                            </p>
                            <p>
                                –ö–Ω–æ–ø–∫–∞ "–ó–∞–≤–µ—Ä—à–∏—Ç–∏ —Ä–∞—É–Ω–¥" —Ç—ñ–ª—å–∫–∏ —É —Ö–æ—Å—Ç–∞.
                                –ü—ñ—Å–ª—è –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—è –ø–æ–∫–∞–∑—É—é—Ç—å—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Ä–∞—É–Ω–¥—É.
                            </p>
                        </div>

                        <div className="score-info">
                            <h3>–ö–µ—Ä—É–≤–∞–Ω–Ω—è.</h3>
                            <p>
                                –í–∞—à–µ —Å–ª–æ–≤–æ - –∂–æ–≤—Ç–∏–º –∫–æ–ª—å–æ—Ä–æ–º. –ô–æ–≥–æ —ñ –º–∞–ª—é–π—Ç–µ. –©–æ–± –≤—ñ–¥–≥–∞–¥—É–≤–∞—Ç–∏ —ñ–Ω—à–∏—Ö:
								–ö–ª—ñ–∫–Ω—É—Ç–∏ –Ω–∞ —Å–ª–æ–≤–æ - –ø–æ—Ç—ñ–º –º–∞–ª—é–Ω–æ–∫ –≥—Ä–∞–≤—Ü—è –ê–ë–û –Ω–∞ –º–∞–ª—é–Ω–æ–∫ - –ø–æ—Ç—ñ–º –Ω–∞ —Å–ª–æ–≤–æ,
								—â–æ–± —Å—Ç–≤–æ—Ä–∏—Ç–∏ –ø–∞—Ä—É —Ç–∞ –≤—ñ–¥–≥–∞–¥–∞—Ç–∏ –º–∞–ª—é–Ω–æ–∫.								
                            </p>
                            <p>
                                –¢–∞–∫–æ–∂ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è drag-and-drop. –°–ª–æ–≤–æ –º–æ–∂–Ω–∞ –ø–µ—Ä–µ—Ç—è–≥—Ç–∏ –Ω–∞ –º–∞–ª—é–Ω–æ–∫. 
								–ó–º—ñ–Ω–∏—Ç–∏ —Å–≤—ñ–π –≤–∏–±—ñ—Ä –ø—ñ—Å–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–∞—Ä–∏ (–º–∞–ª—é–Ω–æ–∫-—Å–ª–æ–≤–æ) –Ω–µ–º–æ–∂–ª–∏–≤–æ. ^_^
                            </p>
                        </div>
                    </div>
                </div>
            );
        }
        
        // –ù–û–í–ò–ô –ö–û–ú–ü–û–ù–ï–ù–¢ –Ü–ì–†–û–í–û–á –î–û–®–ö–ò
        function GameBoard({
            socket,
            playerId,
            roundData,
            drawings,
            setDrawings,
            myGuesses,
            usedNumbers,
            myGuessResults,
            showCorrectAnswers,
            allCorrectAssignments,
            isDrawingLocked,
            makeGuess,
            isHost,
            endRound,
            guessProgress
        }) {
            const canvasRef = useRef(null);
            const [isDrawing, setIsDrawing] = useState(false);
            const [currentColor, setCurrentColor] = useState('#000000');
            const [currentSize, setCurrentSize] = useState(10);
            const [currentTool, setCurrentTool] = useState('pen');
            const [showScoreRules, setShowScoreRules] = useState(false);

            // –ù–æ–≤–µ: Drag-and-Drop —Ç–∞ Select —Å—Ç–∞–Ω
            const [selectedWord, setSelectedWord] = useState(null); // {letter, number, word}
            const [selectedPlayer, setSelectedPlayer] = useState(null); // playerId
            const [draggedWord, setDraggedWord] = useState(null); // {letter, number, word}
            const [hoveredPlayer, setHoveredPlayer] = useState(null); // playerId –ø—Ä–∏ hover –ø—ñ–¥ —á–∞—Å drag
            const [wordAssignments, setWordAssignments] = useState({}); // playerId -> {letter, number, word}

            // –ù–û–í–ï: –¢–∞–π–º–µ—Ä —Ä–∞—É–Ω–¥—É (—Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω–∏–π –∑ —Å–µ—Ä–≤–µ—Ä–æ–º)
            const [roundStartTime, setRoundStartTime] = useState(null); // –ß–∞—Å –ø–æ—á–∞—Ç–∫—É —Ä–∞—É–Ω–¥—É –∑ —Å–µ—Ä–≤–µ—Ä–∞
            const [roundTimer, setRoundTimer] = useState(120); // –ü–æ—Ç–æ—á–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è —Ç–∞–π–º–µ—Ä–∞

            // Custom cursor refs (–¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ - –±–µ–∑ —Ä–µ—Ä–µ–Ω–¥–µ—Ä–æ–≤)
            const customCursorRef = useRef(null);
            const showCustomCursorRef = useRef(false);

            const strokeBufferRef = useRef([]);
            const lastXRef = useRef(null);
            const lastYRef = useRef(null);

            // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: –∫–µ—à–∏—Ä—É–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ —Ä–∞–∑–º–µ—Ä—ã
            const ctxRef = useRef(null);
            const canvasBoundsRef = useRef(null);
            
            const colors = [
                '#000000', '#FF0000', '#00FF00', '#0000FF',
                '#FFFF00', '#FF00FF', '#00FFFF', '#FFA500',
                '#800080', '#D2691E', '#FFC0CB', '#808080',
                '#FF6600', '#006400', '#8B4513', '#20B2AA'
            ];
            
            const sizes = [3, 6, 10, 15, 20];
            
            // –û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –º–∞–ª—é–≤–∞–Ω–Ω—è
            useEffect(() => {
                let animationFrameId;

                const sendStrokes = () => {
                    if (strokeBufferRef.current.length > 0 && socket) {
                        socket.emit('drawing_update', {
                            strokes: strokeBufferRef.current
                        });
                        strokeBufferRef.current = [];
                    }
                    animationFrameId = requestAnimationFrame(sendStrokes);
                };

                animationFrameId = requestAnimationFrame(sendStrokes);

                return () => {
                    cancelAnimationFrame(animationFrameId);
                };
            }, [socket]);

            // –ù–û–í–ï: –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è roundStartTime –∑ —Å–µ—Ä–≤–µ—Ä–æ–º
            useEffect(() => {
                if (roundData?.roundStartTime) {
                    setRoundStartTime(roundData.roundStartTime);
                }
            }, [roundData?.roundStartTime]);

            // –ù–û–í–ï: Countdown —Ç–∞–π–º–µ—Ä —Ä–∞—É–Ω–¥—É (—Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω–∏–π –∑ —Å–µ—Ä–≤–µ—Ä–æ–º)
            useEffect(() => {
                if (!roundStartTime) {
                    setRoundTimer(120);
                    return;
                }

                const updateTimer = () => {
                    const elapsed = Math.floor((Date.now() - roundStartTime) / 1000);
                    const remaining = Math.max(0, 120 - elapsed);
                    setRoundTimer(remaining);
                };

                // –û–¥—Ä–∞–∑—É –æ–Ω–æ–≤–ª—é—î–º–æ —Ç–∞–π–º–µ—Ä
                updateTimer();

                // –û–Ω–æ–≤–ª—é—î–º–æ –∫–æ–∂–Ω—É —Å–µ–∫—É–Ω–¥—É
                const intervalId = setInterval(updateTimer, 1000);

                return () => clearInterval(intervalId);
            }, [roundStartTime]);

            // –û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è cursor —á–µ—Ä–µ–∑ –ø—Ä—è–º–µ DOM –º–∞–Ω—ñ–ø—É–ª—é–≤–∞–Ω–Ω—è
            const updateCustomCursor = useCallback((x, y) => {
                if (!customCursorRef.current) return;

                customCursorRef.current.style.left = `${x}px`;
                customCursorRef.current.style.top = `${y}px`;

                // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–∞–∑–º–µ—Ä –∏ —Ü–≤–µ—Ç
                if (currentTool === 'fill') {
                    customCursorRef.current.style.width = `32px`;
                    customCursorRef.current.style.height = `32px`;
                    customCursorRef.current.style.backgroundColor = 'transparent';
                } else {
                    const size = currentTool === 'eraser' ? currentSize * 2 : currentSize;
                    customCursorRef.current.style.width = `${size}px`;
                    customCursorRef.current.style.height = `${size}px`;
                    customCursorRef.current.style.backgroundColor =
                        currentTool === 'eraser' ? 'rgba(255, 255, 255, 0.8)' : currentColor;
                }

                // –û–±–Ω–æ–≤–ª—è–µ–º –∫–ª–∞—Å—Å
                customCursorRef.current.classList.remove('eraser-cursor', 'pen-cursor', 'fill-cursor');
                if (currentTool === 'eraser') {
                    customCursorRef.current.classList.add('eraser-cursor');
                } else if (currentTool === 'fill') {
                    customCursorRef.current.classList.add('fill-cursor');
                } else {
                    customCursorRef.current.classList.add('pen-cursor');
                }
            }, [currentColor, currentSize, currentTool]);
            
            // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è canvas –∑ –ø—ñ–¥—Ç—Ä–∏–º–∫–æ—é High DPI
            useEffect(() => {
                const canvas = canvasRef.current;
                if (canvas) {
                    // alpha: false —Ç–µ–ø–µ—Ä—å –ë–ï–ó–û–ü–ê–°–ù–û - –ª–∞—Å—Ç–∏–∫ —Ä–∏—Å—É–µ—Ç –±–µ–ª—ã–º, –Ω–µ —Å—Ç–∏—Ä–∞–µ—Ç
                    const ctx = canvas.getContext('2d', {
                        alpha: false,
                        desynchronized: true
                    });
                    ctxRef.current = ctx;

                    // –í–ò–ü–†–ê–í–õ–ï–ù–û: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —Ñ—ñ–∫—Å–æ–≤–∞–Ω—ñ –ª–æ–≥—ñ—á–Ω—ñ —Ä–æ–∑–º—ñ—Ä–∏
                    canvas.width = 640;
                    canvas.height = 480;

                    // CSS —Ä–æ–∑–º—ñ—Ä –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è
                    canvas.style.width = '640px';
                    canvas.style.height = '480px';

                    // –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∫–æ–Ω—Ç–µ–∫—Å—Ç—É
                    ctx.lineCap = 'round';
                    ctx.lineJoin = 'round';
                    ctx.imageSmoothingEnabled = true;
                    ctx.imageSmoothingQuality = 'high';

                    // –ë—ñ–ª–∏–π —Ñ–æ–Ω
                    ctx.globalCompositeOperation = 'source-over';
                    ctx.fillStyle = '#FFFFFF';
                    ctx.fillRect(0, 0, 640, 480);

                    // –ö–µ—à–∏—Ä—É–µ–º —Ä–∞–∑–º–µ—Ä—ã canvas
                    const updateBounds = () => {
                        canvasBoundsRef.current = canvas.getBoundingClientRect();
                    };
                    updateBounds();

                    // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–∏ resize –æ–∫–Ω–∞
                    window.addEventListener('resize', updateBounds);
                    return () => window.removeEventListener('resize', updateBounds);
                }
            }, []);
            
            const startDrawing = (e) => {
                if (isDrawingLocked || !ctxRef.current || !canvasBoundsRef.current) return;

                const ctx = ctxRef.current; // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç

                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –∑–∞–ª–∏–≤–∫–∏
                if (currentTool === 'fill') {
                    // –ó–∞–∫—Ä–∞—à–∏–≤–∞–µ–º –≤–µ—Å—å canvas –≤—ã–±—Ä–∞–Ω–Ω—ã–º —Ü–≤–µ—Ç–æ–º
                    ctx.fillStyle = currentColor;
                    ctx.fillRect(0, 0, 640, 480);

                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ª–∏–≤–∫—É –∫–∞–∫ –æ–¥–Ω–æ –¥–µ–π—Å—Ç–≤–∏–µ
                    const strokeData = {
                        color: currentColor,
                        tool: 'fill',
                        type: 'fill'
                    };

                    strokeBufferRef.current.push(strokeData);
                    return; // –ù–µ –∑–∞–ø—É—Å–∫–∞–µ–º –æ–±—ã—á–Ω–æ–µ —Ä–∏—Å–æ–≤–∞–Ω–∏–µ
                }

                setIsDrawing(true);
                const rect = canvasBoundsRef.current; // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ

                // –í–ò–ü–†–ê–í–õ–ï–ù–û: –ü—Ä–æ—Å—Ç–∞ –Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è –±–µ–∑ DPR
                const x = ((e.clientX || e.touches?.[0]?.clientX) - rect.left) * (640 / rect.width);
                const y = ((e.clientY || e.touches?.[0]?.clientY) - rect.top) * (480 / rect.height);

                lastXRef.current = x;
                lastYRef.current = y;

                // –ú–∞–ª—é–≤–∞–Ω–Ω—è –ø–æ—á–∞—Ç–∫–æ–≤–æ—ó —Ç–æ—á–∫–∏
                if (currentTool === 'eraser') {
                    // –†–∏—Å—É–µ–º –±–µ–ª—ã–º —Ü–≤–µ—Ç–æ–º –≤–º–µ—Å—Ç–æ —Å—Ç–∏—Ä–∞–Ω–∏—è
                    ctx.globalCompositeOperation = 'source-over';
                    ctx.fillStyle = '#FFFFFF';
                    ctx.beginPath();
                    ctx.arc(x, y, currentSize, 0, 2 * Math.PI);
                    ctx.fill();
                } else {
                    ctx.globalCompositeOperation = 'source-over';
                    ctx.fillStyle = currentColor;
                    ctx.beginPath();
                    ctx.arc(x, y, currentSize / 2, 0, 2 * Math.PI);
                    ctx.fill();
                }

                const strokeData = {
                    x: x / 640,  // –ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è –¥–æ –¥—ñ–∞–ø–∞–∑–æ–Ω—É 0-1
                    y: y / 480,  // –ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è –¥–æ –¥—ñ–∞–ø–∞–∑–æ–Ω—É 0-1
                    color: currentColor,
                    size: currentSize,
                    tool: currentTool,
                    type: 'start'
                };

                strokeBufferRef.current.push(strokeData);
            };
            
            const draw = useCallback((e) => {
                if (!isDrawing || isDrawingLocked || lastXRef.current === null || !ctxRef.current || !canvasBoundsRef.current) return;

                e.preventDefault();

                const rect = canvasBoundsRef.current; // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ

                // –í–ò–ü–†–ê–í–õ–ï–ù–û: –ü—Ä–æ—Å—Ç–∞ –Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è –±–µ–∑ DPR
                const x = ((e.clientX || e.touches?.[0]?.clientX) - rect.left) * (640 / rect.width);
                const y = ((e.clientY || e.touches?.[0]?.clientY) - rect.top) * (480 / rect.height);

                const ctx = ctxRef.current; // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç

                // –ú–∞–ª—é–≤–∞–Ω–Ω—è –ª—ñ–Ω—ñ—ó
                ctx.globalCompositeOperation = 'source-over';

                if (currentTool === 'eraser') {
                    // –†–∏—Å—É–µ–º –±–µ–ª—ã–º —Ü–≤–µ—Ç–æ–º
                    ctx.strokeStyle = '#FFFFFF';
                    ctx.lineWidth = currentSize * 2;
                } else {
                    // –û–±—ã—á–Ω–æ–µ —Ä–∏—Å–æ–≤–∞–Ω–∏–µ –∫–∏—Å—Ç—å—é
                    ctx.strokeStyle = currentColor;
                    ctx.lineWidth = currentSize;
                }

                ctx.beginPath();
                ctx.moveTo(lastXRef.current, lastYRef.current);
                ctx.lineTo(x, y);
                ctx.stroke();

                lastXRef.current = x;
                lastYRef.current = y;

                // –í–ò–ü–†–ê–í–õ–ï–ù–û: –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –Ω–æ—Ä–º–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ (0-1)
                const strokeData = {
                    x: x / 640,  // –ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è –¥–æ –¥—ñ–∞–ø–∞–∑–æ–Ω—É 0-1
                    y: y / 480,  // –ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è –¥–æ –¥—ñ–∞–ø–∞–∑–æ–Ω—É 0-1
                    color: currentColor,
                    size: currentSize,
                    tool: currentTool,
                    type: 'draw'
                };

                strokeBufferRef.current.push(strokeData);
            }, [isDrawing, isDrawingLocked, currentColor, currentSize, currentTool]);
            
            const stopDrawing = () => {
                if (isDrawing) {
                    setIsDrawing(false);
                    lastXRef.current = null;
                    lastYRef.current = null;

                    const strokeData = {
                        type: 'end'
                    };
                    strokeBufferRef.current.push(strokeData);
                }
            };
            
            const clearCanvas = () => {
                if (isDrawingLocked || !ctxRef.current) return;

                const ctx = ctxRef.current; // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç

                // –°–∫–∏–¥–∞—î–º–æ –≤—Å—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
                ctx.globalCompositeOperation = 'source-over';

                // –ó–∞–ø–æ–≤–Ω—é—î–º–æ –±—ñ–ª–∏–º –∫–æ–ª—å–æ—Ä–æ–º
                ctx.fillStyle = 'white';
                ctx.fillRect(0, 0, 640, 480);

                strokeBufferRef.current = [];

                if (socket) {
                    socket.emit('clear_canvas');
                }
            };

            // –û–±—Ä–æ–±–Ω–∏–∫–∏ –¥–ª—è –Ω–æ–≤–æ—ó —Å–∏—Å—Ç–µ–º–∏ –≤—ñ–¥–≥–∞–¥—É–≤–∞–Ω–Ω—è
            const createGuess = (wordData, targetPlayerId) => {
                if (!wordData || !targetPlayerId) return;
                if (wordAssignments[targetPlayerId]) return; // –í–∂–µ –∑–∞–∫—Ä—ñ–ø–ª–µ–Ω–æ
                if (myGuesses[targetPlayerId]) return; // –í–∂–µ –≤—ñ–¥–≥–∞–¥–∞–Ω–æ

                console.log(`üéØ User selected: ${wordData.letter}${wordData.number} "${wordData.word}" for player ${targetPlayerId}`);

                // –ó–∞–∫—Ä—ñ–ø–ª—é—î–º–æ –≤–∏–±—ñ—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (–¥–ª—è –≤—ñ–∑—É–∞–ª—å–Ω–æ—ó –ø—ñ–¥–∫–∞–∑–∫–∏)
                setWordAssignments(prev => {
                    const updated = { ...prev, [targetPlayerId]: wordData };
                    console.log('üíæ wordAssignments set (user choice):', updated);
                    return updated;
                });

                // –í–ò–ü–†–ê–í–õ–ï–ù–û: –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä —ñ –±—É–∫–≤—É, —ñ –Ω–æ–º–µ—Ä
                makeGuess(targetPlayerId, wordData.number, wordData.letter);

                // –°–∫–∏–¥–∞—î–º–æ —Å–µ–ª–µ–∫—Ç–∏
                setSelectedWord(null);
                setSelectedPlayer(null);
            };

            // Select —Ä–µ–∂–∏–º - –∫–ª—ñ–∫ –Ω–∞ —Å–ª–æ–≤–æ
            const handleWordClick = (letter, number, word) => {
                // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–∏ —Ü–µ –Ω–µ —Å–≤–æ—î —Å–ª–æ–≤–æ
                if (myAssignment?.letter === letter && myAssignment?.number === number) return;

                // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–∏ —Å–ª–æ–≤–æ –≤–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–µ
                const isUsed = Object.values(wordAssignments).some(
                    w => w.letter === letter && w.number === number
                );
                if (isUsed) return;

                const wordData = { letter, number, word };

                // –Ø–∫—â–æ –≤–∂–µ –≤–∏–±—Ä–∞–Ω–∏–π –≥—Ä–∞–≤–µ—Ü—å - —Å—Ç–≤–æ—Ä—é—î–º–æ –ø–∞—Ä—É
                if (selectedPlayer) {
                    createGuess(wordData, selectedPlayer);
                } else {
                    // –Ü–Ω–∞–∫—à–µ –ø—Ä–æ—Å—Ç–æ –≤–∏–±–∏—Ä–∞—î–º–æ —Å–ª–æ–≤–æ
                    setSelectedWord(wordData);
                }
            };

            // Select —Ä–µ–∂–∏–º - –∫–ª—ñ–∫ –Ω–∞ —Ä–∏—Å—É–Ω–æ–∫ –≥—Ä–∞–≤—Ü—è
            const handlePlayerClick = (targetPlayerId) => {
                if (wordAssignments[targetPlayerId]) return; // –í–∂–µ –∑–∞–∫—Ä—ñ–ø–ª–µ–Ω–æ
                if (myGuesses[targetPlayerId]) return; // –í–∂–µ –≤—ñ–¥–≥–∞–¥–∞–Ω–æ

                // –Ø–∫—â–æ –≤–∂–µ –≤–∏–±—Ä–∞–Ω–µ —Å–ª–æ–≤–æ - —Å—Ç–≤–æ—Ä—é—î–º–æ –ø–∞—Ä—É
                if (selectedWord) {
                    createGuess(selectedWord, targetPlayerId);
                } else {
                    // –Ü–Ω–∞–∫—à–µ –ø—Ä–æ—Å—Ç–æ –≤–∏–±–∏—Ä–∞—î–º–æ –≥—Ä–∞–≤—Ü—è
                    setSelectedPlayer(targetPlayerId);
                }
            };

            // –ö–ª—ñ–∫ –Ω–∞ –ø–æ—Ä–æ–∂–Ω—î –º—ñ—Å—Ü–µ - —Å–∫–∏–¥–∞—î —Å–µ–ª–µ–∫—Ç
            const handleBackgroundClick = (e) => {
                // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –∫–ª—ñ–∫ –±—É–≤ –Ω–µ –ø–æ —Å–ª–æ–≤—É —á–∏ —Ä–∏—Å—É–Ω–∫—É
                if (!e.target.closest('.word-item') && !e.target.closest('.drawing-card')) {
                    setSelectedWord(null);
                    setSelectedPlayer(null);
                }
            };

            // Drag-and-Drop –æ–±—Ä–æ–±–Ω–∏–∫–∏
            const handleWordDragStart = (e, letter, number, word) => {
                // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–∏ —Ü–µ –Ω–µ —Å–≤–æ—î —Å–ª–æ–≤–æ
                if (myAssignment?.letter === letter && myAssignment?.number === number) {
                    e.preventDefault();
                    return;
                }

                // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–∏ —Å–ª–æ–≤–æ –≤–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–µ
                const isUsed = Object.values(wordAssignments).some(
                    w => w.letter === letter && w.number === number
                );
                if (isUsed) {
                    e.preventDefault();
                    return;
                }

                setDraggedWord({ letter, number, word });
                e.dataTransfer.effectAllowed = 'move';
            };

            const handlePlayerDragOver = (e, targetPlayerId) => {
                if (!draggedWord) return;
                if (wordAssignments[targetPlayerId]) return;
                if (myGuesses[targetPlayerId]) return;

                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
                setHoveredPlayer(targetPlayerId);
            };

            const handlePlayerDragLeave = () => {
                setHoveredPlayer(null);
            };

            const handlePlayerDrop = (e, targetPlayerId) => {
                e.preventDefault();
                if (!draggedWord) return;

                createGuess(draggedWord, targetPlayerId);

                setDraggedWord(null);
                setHoveredPlayer(null);
            };

            const handleDragEnd = () => {
                setDraggedWord(null);
                setHoveredPlayer(null);
            };

            // Touch –æ–±—Ä–æ–±–Ω–∏–∫–∏ –¥–ª—è –º–æ–±—ñ–ª—å–Ω–∏—Ö –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤
            const handleWordTouchStart = (e, letter, number, word) => {
                // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–∏ —Ü–µ –Ω–µ —Å–≤–æ—î —Å–ª–æ–≤–æ
                if (myAssignment?.letter === letter && myAssignment?.number === number) {
                    e.preventDefault();
                    return;
                }

                // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–∏ —Å–ª–æ–≤–æ –≤–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–µ
                const isUsed = Object.values(wordAssignments).some(
                    w => w.letter === letter && w.number === number
                );
                if (isUsed) {
                    e.preventDefault();
                    return;
                }

                setDraggedWord({ letter, number, word });
            };

            const handleTouchMove = (e) => {
                if (!draggedWord) return;

                const touch = e.touches[0];
                const element = document.elementFromPoint(touch.clientX, touch.clientY);
                const drawingCard = element?.closest('.drawing-card');

                if (drawingCard) {
                    const playerId = drawingCard.getAttribute('data-player-id');
                    if (playerId && !wordAssignments[playerId]) {
                        setHoveredPlayer(playerId);
                    } else {
                        setHoveredPlayer(null);
                    }
                } else {
                    setHoveredPlayer(null);
                }
            };

            const handleTouchEnd = (e) => {
                if (!draggedWord || !hoveredPlayer) {
                    setDraggedWord(null);
                    setHoveredPlayer(null);
                    return;
                }

                createGuess(draggedWord, hoveredPlayer);

                setDraggedWord(null);
                setHoveredPlayer(null);
            };

            const myAssignment = roundData?.personalAssignment;
            const otherPlayers = roundData?.players?.filter(p => p.id !== playerId) || [];
            
            // –ì—Ä—É–ø—É—î–º–æ —Å–ª–æ–≤–∞ –ø–æ –∫–∞—Ä—Ç–∫–∞—Ö
            const wordsByCard = {
                A: roundData?.wordSet?.A || [],
                B: roundData?.wordSet?.B || [],
                C: roundData?.wordSet?.C || [],
                D: roundData?.wordSet?.D || []
            };
            
            return (
                <>
                    <div className="game-container" onClick={handleBackgroundClick}>
                        {/* –û—Å–Ω–æ–≤–Ω–∞ –∑–æ–Ω–∞ –≥—Ä–∏ */}
                        <div className="game-main">
                            {/* –í–µ—Ä—Ö–Ω—è —á–∞—Å—Ç–∏–Ω–∞ */}
                            <div className="game-top">
                                {/* –õ—ñ–≤–∞ –ø–∞–Ω–µ–ª—å —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤ */}
                                <div className="tools-panel">
                                    <div className="game-status">
                                        <div className="round-info">–†–∞—É–Ω–¥ {roundData?.round} –∑ 4</div>
                                        <button 
                                            className="help-button"
                                            onClick={() => setShowScoreRules(true)}
                                        >
                                            ‚ùì –ü—ñ–¥–∫–∞–∑–∫–∏
                                        </button>
                                    </div>
                                    
                                    <div className="tools-section">
                                        <h3>–Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏</h3>
                                        
                                        <div className="tool-group">
                                            <label>–¢–∏–ø:</label>
                                            <div className="tool-buttons">
                                                <button
                                                    className={`tool-btn ${currentTool === 'pen' ? 'active' : ''}`}
                                                    onClick={() => setCurrentTool('pen')}
                                                    disabled={isDrawingLocked}
                                                >
                                                    ‚úèÔ∏è
                                                </button>
                                                <button
                                                    className={`tool-btn ${currentTool === 'eraser' ? 'active' : ''}`}
                                                    onClick={() => setCurrentTool('eraser')}
                                                    disabled={isDrawingLocked}
                                                    title="–õ–∞—Å—Ç–∏–∫"
                                                >
                                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                                        <path d="M20 20H7L2.5 15.5C1.83 14.83 1.83 13.67 2.5 13L13 2.5C13.67 1.83 14.83 1.83 15.5 2.5L21.5 8.5C22.17 9.17 22.17 10.33 21.5 11L17 15.5"/>
                                                        <path d="M13 2.5L21.5 11"/>
                                                    </svg>
                                                </button>
                                                <button
                                                    className={`tool-btn ${currentTool === 'fill' ? 'active' : ''}`}
                                                    onClick={() => setCurrentTool('fill')}
                                                    disabled={isDrawingLocked}
                                                    title="–ó–∞–ª–∏–≤–∫–∞"
                                                >
                                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" strokeWidth="1.5">
                                                        <path d="M12 2L10 8L4 10L10 12L12 18L14 12L20 10L14 8Z"/>
                                                        <path d="M12 10C10.9 10 10 10.9 10 12L10 18L14 18L14 12C14 10.9 13.1 10 12 10Z"/>
                                                        <path d="M8 20L16 20C17.1 20 18 20.9 18 22L6 22C6 20.9 6.9 20 8 20Z"/>
                                                    </svg>
                                                </button>
                                            </div>
                                        </div>
                                        
                                        <div className="tool-group">
                                            <label>–ö–æ–ª—ñ—Ä:</label>
                                            <div className="color-palette">
                                                {colors.map(color => (
                                                    <button
                                                        key={color}
                                                        className={`color-btn ${currentColor === color ? 'active' : ''}`}
                                                        style={{ backgroundColor: color }}
                                                        onClick={() => setCurrentColor(color)}
                                                        disabled={isDrawingLocked || currentTool === 'eraser'}
                                                    />
                                                ))}
                                            </div>
                                        </div>
                                        
                                        <div className="tool-group">
                                            <div className="size-selector">
                                                {sizes.map(size => (
                                                    <button
                                                        key={size}
                                                        className={`size-btn ${currentSize === size ? 'active' : ''}`}
                                                        onClick={() => setCurrentSize(size)}
                                                        disabled={isDrawingLocked || currentTool === 'fill'}
                                                        title={`–†–æ–∑–º—ñ—Ä: ${size}px`}
                                                    >
                                                        <div
                                                            className="size-dot"
                                                            style={{ width: size * 0.5, height: size * 0.5 }}
                                                        />
                                                    </button>
                                                ))}
                                            </div>
                                        </div>
                                        
                                        <div className="action-buttons">
                                            <button
                                                className="action-btn btn-danger"
                                                onClick={clearCanvas}
                                                disabled={isDrawingLocked}
                                            >
                                                –û—á–∏—Å—Ç–∏—Ç–∏
                                            </button>

                                            {/* –ù–û–í–ï: –ü—Ä–æ–≥—Ä–µ—Å –∑–¥–æ–≥–∞–¥–æ–∫ (—Ç—ñ–ª—å–∫–∏ –¥–ª—è —Ö–æ—Å—Ç–∞) */}
                                            {isHost && guessProgress && Object.keys(guessProgress).length > 0 && (
                                                <div style={{
                                                    borderTop: '2px solid #e0e0e0',
                                                    marginTop: '10px',
                                                    paddingTop: '10px',
                                                    marginBottom: '10px'
                                                }}>
                                                    <label style={{
                                                        fontSize: '0.8em',
                                                        color: '#667eea',
                                                        marginBottom: '8px',
                                                        display: 'block',
                                                        fontWeight: '600'
                                                    }}>
                                                        –ü—Ä–æ–≥—Ä–µ—Å –∑–¥–æ–≥–∞–¥–æ–∫:
                                                    </label>
                                                    <div style={{
                                                        maxHeight: '200px',
                                                        overflowY: 'auto',
                                                        fontSize: '0.85em'
                                                    }}>
                                                        {Object.entries(guessProgress).map(([pid, data]) => {
                                                            const nameLength = data.name?.length || 0;
                                                            const fontSize = nameLength > 20 ? '0.7em' : nameLength > 15 ? '0.8em' : '1em';
                                                            return (
                                                                <div key={pid} style={{
                                                                    padding: '4px 8px',
                                                                    marginBottom: '3px',
                                                                    background: data.guessed === data.total ? '#d4edda' : '#fff',
                                                                    borderRadius: '4px',
                                                                    border: '1px solid #e0e0e0'
                                                                }}>
                                                                    <span style={{
                                                                        fontWeight: 'bold',
                                                                        color: '#333',
                                                                        fontSize: fontSize,
                                                                        wordBreak: 'break-word'
                                                                    }}>
                                                                        {data.name}
                                                                    </span>
                                                                    {' '}
                                                                    <span style={{
                                                                        color: data.guessed === data.total ? '#28a745' : '#666',
                                                                        fontWeight: '600',
                                                                        fontSize: fontSize
                                                                    }}>
                                                                        ({data.guessed}/{data.total})
                                                                    </span>
                                                                    {data.guessed === data.total && ' ‚úì'}
                                                                </div>
                                                            );
                                                        })}
                                                    </div>
                                                </div>
                                            )}

                                            {/* –ö–Ω–æ–ø–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ä–∞—É–Ω–¥—É (—Ç—ñ–ª—å–∫–∏ –¥–ª—è —Ö–æ—Å—Ç–∞) */}
                                            {isHost && otherPlayers.length > 0 && (
                                                <div style={{
                                                    borderTop: '2px solid #e0e0e0',
                                                    marginTop: '10px',
                                                    paddingTop: '10px'
                                                }}>
                                                    <label style={{
                                                        fontSize: '0.8em',
                                                        color: '#667eea',
                                                        marginBottom: '5px',
                                                        display: 'block',
                                                        fontWeight: '600'
                                                    }}>
                                                        –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è (–•–æ—Å—Ç):
                                                    </label>

                                                    <button
                                                        className="action-btn btn-primary"
                                                        onClick={endRound}
                                                        title="–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å —â–æ–± –∑–∞–≤–µ—Ä—à–∏—Ç–∏ —Ä–∞—É–Ω–¥ —ñ –ø–æ–∫–∞–∑–∞—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏"
                                                    >
                                                        –ó–∞–≤–µ—Ä—à–∏—Ç–∏ —Ä–∞—É–Ω–¥
                                                    </button>

                                                    {!showCorrectAnswers && (
                                                        <button
                                                            className="action-btn btn-success"
                                                            onClick={() => {
                                                                if (socket) {
                                                                    socket.emit('reveal_answers');
                                                                }
                                                            }}
                                                            title="–ü–æ–∫–∞–∑–∞—Ç–∏ –≤—Å—ñ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ (—è–∫—ñ —Å–ª–æ–≤–∞ –Ω–∞—Å–ø—Ä–∞–≤–¥—ñ –±—É–ª–∏ –∑–∞–≥–∞–¥–∞–Ω—ñ)"
                                                            style={{ marginTop: '5px' }}
                                                        >
                                                            –ü–æ–∫–∞–∑–∞—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
                                                        </button>
                                                    )}
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                </div>
                                
                                {/* –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞ –∑–æ–Ω–∞ –∑ –∫–∞–Ω–≤–∞—Å–æ–º */}
                                <div className="canvas-section">
                                    {/* –ó–∞–≤–¥–∞–Ω–Ω—è */}
                                    {myAssignment && (
                                        <div className="task-header" style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', position: 'relative' }}>
                                            {/* –¢–∞–π–º–µ—Ä –∑–ª—ñ–≤–∞ */}
                                            <div style={{
                                                position: 'absolute',
                                                left: '15px',
                                                fontSize: '1.3em',
                                                fontWeight: 'bold',
                                                color: roundTimer <= 30 ? '#f44336' : '#333',
                                                minWidth: '50px'
                                            }}>
                                                {roundTimer}
                                            </div>

                                            {/* –°–ª–æ–≤–æ-–∑–∞–≤–¥–∞–Ω–Ω—è –ø–æ —Ü–µ–Ω—Ç—Ä—É */}
                                            <div className="task-word" style={{
                                                flex: 1,
                                                fontSize: (() => {
                                                    const word = myAssignment.word || '';
                                                    const length = word.length;
                                                    const wordCount = word.split(' ').length;
                                                    // –ê–¥–∞–ø—Ç–∏–≤–Ω–∏–π —Ä–æ–∑–º—ñ—Ä —à—Ä–∏—Ñ—Ç—É
                                                    if (wordCount > 1 || length > 15) return '1.1em';
                                                    if (length > 10) return '1.2em';
                                                    return '1.4em';
                                                })()
                                            }}>{myAssignment.word}</div>
                                        </div>
                                    )}
                                    
                                    {/* –ú—ñ–π –∫–∞–Ω–≤–∞—Å */}
                                    <div className="my-canvas-wrapper">
                                        <div className={`canvas-container ${isDrawingLocked ? 'locked' : ''}`}>
                                            {isDrawingLocked && (
                                                <div className="canvas-lock-overlay">
                                                    <div className="lock-message">
                                                        –ú–∞–ª—é–Ω–æ–∫ –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ
                                                    </div>
                                                </div>
                                            )}
                                            <canvas
                                                ref={canvasRef}
                                                width={640}
                                                height={480}
                                                onMouseDown={startDrawing}
                                                onMouseMove={(e) => {
                                                    draw(e);
                                                    // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é custom cursor –±–µ–∑ —Ä–µ—Ä–µ–Ω–¥–µ—Ä–∞
                                                    updateCustomCursor(e.clientX, e.clientY);
                                                }}
                                                onMouseEnter={(e) => {
                                                    if (!isDrawingLocked && customCursorRef.current) {
                                                        showCustomCursorRef.current = true;
                                                        customCursorRef.current.style.display = 'block';
                                                        updateCustomCursor(e.clientX, e.clientY);
                                                    }
                                                }}
                                                onMouseLeave={() => {
                                                    stopDrawing();
                                                    if (customCursorRef.current) {
                                                        showCustomCursorRef.current = false;
                                                        customCursorRef.current.style.display = 'none';
                                                    }
                                                }}
                                                onMouseUp={stopDrawing}
                                                onTouchStart={startDrawing}
                                                onTouchMove={draw}
                                                onTouchEnd={stopDrawing}
                                                style={{
                                                    cursor: isDrawingLocked ? 'not-allowed' : 'none',
                                                    touchAction: 'none'
                                                }}
                                            />
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            {/* –ù–∏–∂–Ω—è —Å–µ–∫—Ü—ñ—è –∑ –∫–∞–Ω–≤–∞—Å–∞–º–∏ —ñ–Ω—à–∏—Ö */}
                            <div className="others-section">
                                <div className="others-content">
                                    <div className="others-grid">
                                        {otherPlayers.map(player => (
                                            <OtherPlayerDrawing
                                                key={player.id}
                                                player={player}
                                                drawing={drawings[player.id] || []}
                                                guess={myGuesses[player.id]}
                                                // –ù–æ–≤–∞ —Å–∏—Å—Ç–µ–º–∞ –≤—ñ–¥–≥–∞–¥—É–≤–∞–Ω–Ω—è
                                                wordAssignment={wordAssignments[player.id]}
                                                guessResult={myGuessResults[player.id]}
                                                showCorrectAnswers={showCorrectAnswers}
                                                isSelected={selectedPlayer === player.id}
                                                isHovered={hoveredPlayer === player.id}
                                                onClick={() => handlePlayerClick(player.id)}
                                                onDragOver={(e) => handlePlayerDragOver(e, player.id)}
                                                onDragLeave={handlePlayerDragLeave}
                                                onDrop={(e) => handlePlayerDrop(e, player.id)}
                                            />
                                        ))}
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        {/* –ü—Ä–∞–≤–∞ –ø–∞–Ω–µ–ª—å –∑ –∫–∞—Ä—Ç–∫–∞–º–∏ */}
                        <div className="cards-panel">
                            {/* –õ—ñ–≤–∏–π —Å—Ç–æ–≤–ø–µ—Ü—å: A + B (18 —Å–ª—ñ–≤) */}
                            <div className="word-column">
                                {[...wordsByCard.A, ...wordsByCard.B].map((word, globalIndex) => {
                                    const letter = globalIndex < 9 ? 'A' : 'B';
                                    const number = globalIndex < 9 ? globalIndex + 1 : globalIndex - 8;
                                    const isMyWord = myAssignment?.letter === letter && myAssignment?.number === number;
                                    const isUsed = Object.values(wordAssignments).some(
                                        w => w.letter === letter && w.number === number
                                    );
                                    const isSelected = selectedWord?.letter === letter && selectedWord?.number === number;

                                    // –í–ò–ü–†–ê–í–õ–ï–ù–û: –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ —Ü–µ —Å–ª–æ–≤–æ - –≤–∏–±—ñ—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∞–±–æ –ø—Ä–∞–≤–∏–ª—å–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å
                                    // 1. –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–∏–±—Ä–∞–≤ —Ü–µ —Å–ª–æ–≤–æ
                                    const userSelectedPlayerId = Object.keys(wordAssignments).find(
                                        pid => wordAssignments[pid].letter === letter && wordAssignments[pid].number === number
                                    );
                                    const userGuessResult = userSelectedPlayerId ? myGuessResults[userSelectedPlayerId] : null;

                                    // 2. –í–ò–ü–†–ê–í–õ–ï–ù–û: –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ —Ü–µ –ø—Ä–∞–≤–∏–ª—å–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å (—à—É–∫–∞—î–º–æ —É –≤—Å—ñ—Ö –ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥—è—Ö)
                                    const correctAnswerPlayerId = Object.keys(allCorrectAssignments).find(
                                        pid => allCorrectAssignments[pid]?.letter === letter &&
                                               allCorrectAssignments[pid]?.number === number
                                    );

                                    // –í–ò–ü–†–ê–í–õ–ï–ù–û: –õ–æ–≥—ñ–∫–∞ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Å—Ç–∞–Ω—ñ–≤
                                    const isPending = userGuessResult && !showCorrectAnswers; // –í–∏–±—Ä–∞–Ω–æ, –∞–ª–µ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –Ω–µ –ø–æ–∫–∞–∑–∞–Ω—ñ
                                    const isCorrect = showCorrectAnswers && ((userGuessResult?.correct === true) || (correctAnswerPlayerId !== undefined));
                                    const isIncorrect = showCorrectAnswers && (userGuessResult?.correct === false) && (correctAnswerPlayerId === undefined); // –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ü –ù–ï —î –ø—Ä–∞–≤–∏–ª—å–Ω–∏–º –¥–ª—è —ñ–Ω—à–∏—Ö

                                    return (
                                        <div
                                            key={`${letter}-${number}`}
                                            className={`word-item ${isMyWord ? 'my-word' : ''} ${isUsed ? 'used' : ''} ${isSelected ? 'selected' : ''} ${isPending ? 'pending' : ''} ${isCorrect ? 'correct' : ''} ${isIncorrect ? 'incorrect' : ''}`}
                                            title={word}
                                            draggable={!isMyWord && !isUsed}
                                            onClick={() => handleWordClick(letter, number, word)}
                                            onDragStart={(e) => handleWordDragStart(e, letter, number, word)}
                                            onDragEnd={handleDragEnd}
                                            onTouchStart={(e) => handleWordTouchStart(e, letter, number, word)}
                                            onTouchMove={handleTouchMove}
                                            onTouchEnd={handleTouchEnd}
                                            style={{
                                                cursor: isMyWord || isUsed ? 'not-allowed' : 'pointer',
                                                touchAction: 'none'
                                            }}
                                        >
                                            <span className="word-text">{word}</span>
                                        </div>
                                    );
                                })}
                            </div>

                            {/* –ü—Ä–∞–≤–∏–π —Å—Ç–æ–≤–ø–µ—Ü—å: C + D (18 —Å–ª—ñ–≤) */}
                            <div className="word-column">
                                {[...wordsByCard.C, ...wordsByCard.D].map((word, globalIndex) => {
                                    const letter = globalIndex < 9 ? 'C' : 'D';
                                    const number = globalIndex < 9 ? globalIndex + 1 : globalIndex - 8;
                                    const isMyWord = myAssignment?.letter === letter && myAssignment?.number === number;
                                    const isUsed = Object.values(wordAssignments).some(
                                        w => w.letter === letter && w.number === number
                                    );
                                    const isSelected = selectedWord?.letter === letter && selectedWord?.number === number;

                                    // –í–ò–ü–†–ê–í–õ–ï–ù–û: –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ —Ü–µ —Å–ª–æ–≤–æ - –≤–∏–±—ñ—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∞–±–æ –ø—Ä–∞–≤–∏–ª—å–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å
                                    // 1. –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–∏–±—Ä–∞–≤ —Ü–µ —Å–ª–æ–≤–æ
                                    const userSelectedPlayerId = Object.keys(wordAssignments).find(
                                        pid => wordAssignments[pid].letter === letter && wordAssignments[pid].number === number
                                    );
                                    const userGuessResult = userSelectedPlayerId ? myGuessResults[userSelectedPlayerId] : null;

                                    // 2. –í–ò–ü–†–ê–í–õ–ï–ù–û: –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ —Ü–µ –ø—Ä–∞–≤–∏–ª—å–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å (—à—É–∫–∞—î–º–æ —É –≤—Å—ñ—Ö –ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥—è—Ö)
                                    const correctAnswerPlayerId = Object.keys(allCorrectAssignments).find(
                                        pid => allCorrectAssignments[pid]?.letter === letter &&
                                               allCorrectAssignments[pid]?.number === number
                                    );

                                    // –í–ò–ü–†–ê–í–õ–ï–ù–û: –õ–æ–≥—ñ–∫–∞ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Å—Ç–∞–Ω—ñ–≤
                                    const isPending = userGuessResult && !showCorrectAnswers; // –í–∏–±—Ä–∞–Ω–æ, –∞–ª–µ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –Ω–µ –ø–æ–∫–∞–∑–∞–Ω—ñ
                                    const isCorrect = showCorrectAnswers && ((userGuessResult?.correct === true) || (correctAnswerPlayerId !== undefined));
                                    const isIncorrect = showCorrectAnswers && (userGuessResult?.correct === false) && (correctAnswerPlayerId === undefined); // –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ü –ù–ï —î –ø—Ä–∞–≤–∏–ª—å–Ω–∏–º –¥–ª—è —ñ–Ω—à–∏—Ö

                                    return (
                                        <div
                                            key={`${letter}-${number}`}
                                            className={`word-item ${isMyWord ? 'my-word' : ''} ${isUsed ? 'used' : ''} ${isSelected ? 'selected' : ''} ${isPending ? 'pending' : ''} ${isCorrect ? 'correct' : ''} ${isIncorrect ? 'incorrect' : ''}`}
                                            title={word}
                                            draggable={!isMyWord && !isUsed}
                                            onClick={() => handleWordClick(letter, number, word)}
                                            onDragStart={(e) => handleWordDragStart(e, letter, number, word)}
                                            onDragEnd={handleDragEnd}
                                            onTouchStart={(e) => handleWordTouchStart(e, letter, number, word)}
                                            onTouchMove={handleTouchMove}
                                            onTouchEnd={handleTouchEnd}
                                            style={{
                                                cursor: isMyWord || isUsed ? 'not-allowed' : 'pointer',
                                                touchAction: 'none'
                                            }}
                                        >
                                            <span className="word-text">{word}</span>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    </div>
                    
                    {showScoreRules && (
                        <ScoreRulesModal onClose={() => setShowScoreRules(false)} />
                    )}

                    {/* Custom cursor - –≤—Å–µ–≥–¥–∞ –≤ DOM, –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ ref */}
                    {!isDrawingLocked && (
                        <div
                            ref={customCursorRef}
                            className="custom-cursor pen-cursor"
                            style={{
                                display: 'none',
                                left: 0,
                                top: 0,
                                width: currentSize,
                                height: currentSize,
                                backgroundColor: currentColor
                            }}
                        />
                    )}
                </>
            );
        }
        
        // –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –º–∞–ª—é–Ω–∫—ñ–≤ —ñ–Ω—à–∏—Ö –≥—Ä–∞–≤—Ü—ñ–≤
        function OtherPlayerDrawing({
            player,
            drawing,
            guess,
            // –ù–æ–≤–∞ —Å–∏—Å—Ç–µ–º–∞ –≤—ñ–¥–≥–∞–¥—É–≤–∞–Ω–Ω—è
            wordAssignment,
            guessResult,
            showCorrectAnswers,
            isSelected,
            isHovered,
            onClick,
            onDragOver,
            onDragLeave,
            onDrop
        }) {
            const canvasRef = useRef(null);
            const [canvasSize] = useState({ width: 240, height: 180 });
            const lastDrawnIndexRef = useRef(0); // –ò–Ω–¥–µ–∫—Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ—Ç—Ä–∏—Å–æ–≤–∞–Ω–Ω–æ–≥–æ stroke
            const isDrawingPathRef = useRef(false);
            const lastXRef = useRef(null);
            const lastYRef = useRef(null);

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è canvas —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑
            useEffect(() => {
                const canvas = canvasRef.current;
                if (!canvas) return;

                // alpha: false –±–µ–∑–æ–ø–∞—Å–Ω–æ - –ª–∞—Å—Ç–∏–∫ —Ä–∏—Å—É–µ—Ç –±–µ–ª—ã–º
                const ctx = canvas.getContext('2d', { alpha: false });

                canvas.width = canvasSize.width;
                canvas.height = canvasSize.height;

                ctx.lineCap = 'round';
                ctx.lineJoin = 'round';
                ctx.imageSmoothingEnabled = true;
                ctx.imageSmoothingQuality = 'high';

                // –ë—ñ–ª–∏–π —Ñ–æ–Ω
                ctx.fillStyle = '#FFFFFF';
                ctx.fillRect(0, 0, canvasSize.width, canvasSize.height);

                lastDrawnIndexRef.current = 0;
            }, [canvasSize]); // –¢–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞!

            // –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ - —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ strokes
            useEffect(() => {
                const canvas = canvasRef.current;
                if (!canvas) return;

                const ctx = canvas.getContext('2d', { alpha: false });

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ clear_canvas —Å–æ–±—ã—Ç–∏–µ
                if (drawing.length === 0 && lastDrawnIndexRef.current > 0) {
                    // Canvas –±—ã–ª –æ—á–∏—â–µ–Ω
                    ctx.fillStyle = '#FFFFFF';
                    ctx.fillRect(0, 0, canvasSize.width, canvasSize.height);
                    lastDrawnIndexRef.current = 0;
                    isDrawingPathRef.current = false;
                    lastXRef.current = null;
                    lastYRef.current = null;
                    return;
                }

                // –†–∏—Å—É–µ–º —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ strokes –Ω–∞—á–∏–Ω–∞—è —Å lastDrawnIndex
                for (let i = lastDrawnIndexRef.current; i < drawing.length; i++) {
                    const stroke = drawing[i];

                    if (stroke.type === 'fill') {
                        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ª–∏–≤–∫–∏ –≤—Å–µ–≥–æ canvas
                        ctx.fillStyle = stroke.color;
                        ctx.fillRect(0, 0, canvasSize.width, canvasSize.height);
                        isDrawingPathRef.current = false;
                        lastXRef.current = null;
                        lastYRef.current = null;
                    } else if (stroke.type === 'start') {
                        const x = stroke.x * canvasSize.width;
                        const y = stroke.y * canvasSize.height;

                        ctx.globalCompositeOperation = 'source-over';
                        if (stroke.tool === 'eraser') {
                            // –†–∏—Å—É–µ–º –±–µ–ª—ã–º –≤–º–µ—Å—Ç–æ —Å—Ç–∏—Ä–∞–Ω–∏—è
                            ctx.fillStyle = '#FFFFFF';
                            ctx.beginPath();
                            ctx.arc(x, y, stroke.size * (canvasSize.width / 640), 0, 2 * Math.PI);
                            ctx.fill();
                        } else {
                            ctx.fillStyle = stroke.color;
                            ctx.beginPath();
                            ctx.arc(x, y, (stroke.size * (canvasSize.width / 640)) / 2, 0, 2 * Math.PI);
                            ctx.fill();
                        }

                        lastXRef.current = x;
                        lastYRef.current = y;
                        isDrawingPathRef.current = true;
                    } else if (stroke.type === 'draw' && isDrawingPathRef.current && lastXRef.current !== null) {
                        const x = stroke.x * canvasSize.width;
                        const y = stroke.y * canvasSize.height;

                        ctx.globalCompositeOperation = 'source-over';
                        if (stroke.tool === 'eraser') {
                            // –†–∏—Å—É–µ–º –±–µ–ª—ã–º –≤–º–µ—Å—Ç–æ —Å—Ç–∏—Ä–∞–Ω–∏—è
                            ctx.strokeStyle = '#FFFFFF';
                            ctx.lineWidth = stroke.size * 2 * (canvasSize.width / 640);
                        } else {
                            ctx.strokeStyle = stroke.color;
                            ctx.lineWidth = stroke.size * (canvasSize.width / 640);
                        }

                        ctx.beginPath();
                        ctx.moveTo(lastXRef.current, lastYRef.current);
                        ctx.lineTo(x, y);
                        ctx.stroke();

                        lastXRef.current = x;
                        lastYRef.current = y;
                    } else if (stroke.type === 'end') {
                        isDrawingPathRef.current = false;
                        lastXRef.current = null;
                        lastYRef.current = null;
                        ctx.globalCompositeOperation = 'source-over';
                    }
                }

                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–µ–∫—Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ—Ç—Ä–∏—Å–æ–≤–∞–Ω–Ω–æ–≥–æ stroke
                lastDrawnIndexRef.current = drawing.length;
            }, [drawing, canvasSize]);

            // –í–ò–ü–†–ê–í–õ–ï–ù–û: –õ–æ–≥—ñ–∫–∞ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Å—Ç–∞–Ω—ñ–≤
            const isPending = wordAssignment && !showCorrectAnswers; // –í–∏–±—Ä–∞–Ω–æ, –∞–ª–µ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –Ω–µ –ø–æ–∫–∞–∑–∞–Ω—ñ
            const isCorrect = showCorrectAnswers && ((guessResult?.correct === true) || guessResult?.targetAssignment);
            const isIncorrect = showCorrectAnswers && (guessResult?.correct === false);

            // –í–ò–ü–†–ê–í–õ–ï–ù–û: –õ–æ–≥—ñ–∫–∞ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Å–ª–æ–≤–∞
            // 1. –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–∏–±—Ä–∞–≤ —Å–ª–æ–≤–æ (wordAssignment) - –ø–æ–∫–∞–∑—É—î–º–æ –π–æ–≥–æ
            // 2. –Ø–∫—â–æ –ù–ï–¢ wordAssignment, –∞–ª–µ —î –ø—Ä–∞–≤–∏–ª—å–Ω–µ —Å–ª–æ–≤–æ (targetAssignment) –Ü showCorrectAnswers=true - –ø–æ–∫–∞–∑—É—î–º–æ –ø—Ä–∞–≤–∏–ª—å–Ω–µ
            let displayWord = null;
            let wordColor = '#2196f3'; // –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –≥–æ–ª—É–±–∏–π

            if (wordAssignment) {
                // –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–∏–±—Ä–∞–≤ —Å–ª–æ–≤–æ
                if (isPending) {
                    // –ü–æ–∫–∞–∑—É—î–º–æ –≤–∏–±—Ä–∞–Ω–µ —Å–ª–æ–≤–æ –≥–æ–ª—É–±–∏–º
                    displayWord = wordAssignment.word;
                    wordColor = '#2196f3';
                } else if (guessResult?.correct === true) {
                    // –ü–æ–∫–∞–∑—É—î–º–æ –≤–∏–±—Ä–∞–Ω–µ —Å–ª–æ–≤–æ –∑–µ–ª–µ–Ω–∏–º
                    displayWord = wordAssignment.word;
                    wordColor = '#4caf50';
                } else if (guessResult?.correct === false) {
                    // –í–ò–ü–†–ê–í–õ–ï–ù–û: –ü–æ–∫–∞–∑—É—î–º–æ –ü–†–ê–í–ò–õ–¨–ù–ï —Å–ª–æ–≤–æ —á–µ—Ä–≤–æ–Ω–∏–º (—â–æ–± –≥—Ä–∞–≤–µ—Ü—å –ø–æ–±–∞—á–∏–≤ –ø—Ä–∞–≤–∏–ª—å–Ω—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å)
                    displayWord = guessResult?.targetAssignment?.word || wordAssignment.word;
                    wordColor = '#f44336';
                } else {
                    displayWord = wordAssignment.word;
                    wordColor = '#2196f3';
                }
            } else if (guessResult?.targetAssignment && showCorrectAnswers) {
                // –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–µ –≤–∏–±—Ä–∞–≤, –∞–ª–µ —Ö–æ—Å—Ç –ø–æ–∫–∞–∑–∞–≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
                displayWord = guessResult.targetAssignment.word;
                wordColor = '#4caf50'; // –ó–∞–≤–∂–¥–∏ –∑–µ–ª–µ–Ω–∏–π –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π
            }

            const hasAssignment = displayWord !== null;

            return (
                <div
                    className={`drawing-card ${hasAssignment ? 'matched' : ''} ${isSelected ? 'selected' : ''} ${isHovered ? 'drag-over' : ''} ${isPending ? 'pending' : ''} ${isCorrect ? 'correct' : ''} ${isIncorrect ? 'incorrect' : ''}`}
                    data-player-id={player.id}
                    onClick={onClick}
                    onDragOver={onDragOver}
                    onDragLeave={onDragLeave}
                    onDrop={onDrop}
                    style={{
                        cursor: hasAssignment ? 'not-allowed' : 'pointer'
                    }}
                >
                    <div className="drawing-player-name">
                        {player.name}
                        {hasAssignment && (
                            <div style={{
                                fontSize: '0.75em',
                                color: wordColor,
                                marginTop: '2px',
                                fontWeight: '600'
                            }}>
                                {displayWord}
                            </div>
                        )}
                    </div>
                    <canvas
                        ref={canvasRef}
                        style={{
                            width: '100%',
                            borderRadius: '8px',
                            background: 'white',
                            border: '1px solid #e0e0e0'
                        }}
                    />
                    
                </div>
            );
        }
        
        // –†–µ–Ω–¥–µ—Ä –¥–æ–¥–∞—Ç–∫—É –∑ –Ω–æ–≤–∏–º API React 18
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<Game />);
    </script>
</body>
</html>